"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[936],{8554:function(t,e,r){r.d(e,{Z:function(){return i},j:function(){return c}});var a=r(7437),o=r(2265),s=r(164);let n=(0,o.createContext)(void 0),c=()=>{let t=(0,o.useContext)(n);if(!t)throw Error("useCart must be used within a CartProvider");return t},i=t=>{let{children:e}=t,[r,c]=(0,o.useState)([]),[i,d]=(0,o.useState)(!0),[l,u]=(0,o.useState)(null),[g,y]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let t=async()=>{try{let t=await s.h.auth.getProfile().catch(()=>null);y(!!t)}catch(t){y(!1)}};t()},[]),(0,o.useEffect)(()=>{let t=async()=>{try{if(d(!0),g){let t=await s.h.cart.get();c(t.items.map(f))}else{let t=localStorage.getItem("cart");if(t){let e=JSON.parse(t);c(e)}}u(null)}catch(t){if(g)u("Не удалось загрузить корзину"),console.error("Error loading cart:",t);else{let e=localStorage.getItem("cart");if(e){let t=JSON.parse(e);c(t),u(null)}else u("Не удалось загрузить корзину"),console.error("Error loading cart:",t)}}finally{d(!1)}};t()},[g]);let f=t=>({...t,_id:t.product._id}),p=t=>{localStorage.setItem("cart",JSON.stringify(t))},h=async()=>{try{if(d(!0),g){let t=await s.h.cart.get();c(t.items.map(f))}else{let t=localStorage.getItem("cart");if(t){let e=JSON.parse(t);c(e)}}u(null)}catch(t){u("Ошибка синхронизации корзины"),console.error("Cart sync error:",t)}finally{d(!1)}},m=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;try{if(console.log("addItem called with:",{productId:t._id,quantity:e,size:a,color:o}),console.log("Current items before adding:",r),g)await s.h.cart.add(t._id,e,a,o),await h();else{let s;let n={_id:t._id,product:{...t,category:t.category||(t.categoryId?{_id:t.categoryId._id,name:t.categoryId.name,slug:t.categoryId.slug,isActive:!0,sortOrder:1,level:1}:void 0)},quantity:e,size:a,color:o},i=r.findIndex(e=>e._id===t._id&&e.size===a&&e.color===o);console.log("Existing item index:",i),i>=0?(s=[...r],s[i].quantity+=e,console.log("Updated existing item quantity:",s[i].quantity)):(s=[...r,n],console.log("Added new item to cart")),console.log("Updated items after adding:",s),c(s),p(s)}}catch(t){u("Не удалось добавить товар в корзину"),console.error("Add to cart error:",t)}},v=async(t,e,a)=>{try{if(g)await s.h.cart.remove(t,e,a),await h();else{let o=r.filter(r=>!(r._id===t&&r.size===e&&r.color===a));c(o),p(o)}}catch(t){u("Не удалось удалить товар из корзины"),console.error("Remove from cart error:",t)}},w=async(t,e,a,o)=>{try{if(g)await s.h.cart.update(t,e,a,o),await h();else{let s=r.map(r=>r._id===t&&r.size===a&&r.color===o?{...r,quantity:e}:r);c(s),p(s)}}catch(t){u("Не удалось обновить количество товара"),console.error("Update quantity error:",t)}},P=async()=>{try{g?(await s.h.cart.clear(),await h()):(c([]),localStorage.removeItem("cart"))}catch(t){u("Не удалось очистить корзину"),console.error("Clear cart error:",t)}},S=r.length,b=r.reduce((t,e)=>t+e.quantity,0),A=r.reduce((t,e)=>t+e.product.price*e.quantity,0);return(0,a.jsx)(n.Provider,{value:{items:r,totalItems:S,totalQuantity:b,totalPrice:A,loading:i,error:l,addItem:m,removeItem:v,updateQuantity:w,clearCart:P,isInCart:(t,e,a)=>{console.log("isInCart called with:",{productId:t,size:e,color:a}),console.log("Current cart items:",r);let o=r.some(r=>r._id===t&&r.size===e&&r.color===a);return console.log("isInCart result:",o),o},getCartItem:(t,e,a)=>r.find(r=>r._id===t&&r.size===e&&r.color===a)},children:e})}},3023:function(t,e,r){r.d(e,{z:function(){return d}});var a=r(7437),o=r(2265),s=r(7256),n=r(9213),c=r(9311);let i=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=o.forwardRef((t,e)=>{let{className:r,variant:o,size:n,asChild:d=!1,...l}=t,u=d?s.g7:"button";return(0,a.jsx)(u,{className:(0,c.cn)(i({variant:o,size:n,className:r})),ref:e,...l})});d.displayName="Button"},164:function(t,e,r){r.d(e,{h:function(){return s}});let a="https://api.dvberry.ru/api";async function o(t,e){let r=0;for(console.log("API Request: ".concat(a).concat(t));r<=3;)try{let o=await fetch("".concat(a).concat(t),{...e,headers:{"Content-Type":"application/json",...null==e?void 0:e.headers},credentials:"include"});if(console.log("API Response status: ".concat(o.status," for ").concat(t)),429===o.status){if(++r>3)throw Error("Too many requests. Please try again later.");let t=1e3*Math.pow(2,r);await new Promise(e=>setTimeout(e,t));continue}if(!o.ok){let e;if(t.includes("/auth/")&&(401===o.status||404===o.status))throw await o.json().catch(()=>({})),console.log("Auth endpoint returned",o.status,"- user likely not authenticated"),Error("Not authenticated");try{e=await o.json()}catch(t){e={message:"HTTP error! status: ".concat(o.status)}}throw console.error("API Error:",e),Error(e.message||"API request failed")}let s=await o.json();return console.log("✅ API Response data for ".concat(t,":"),s),!t.includes("/products")||(null==s?void 0:s.success)||console.warn("⚠️ Products API response:",s),s}catch(e){if(console.error("API Request failed for ".concat(t,":"),e),e instanceof TypeError&&r<3){r++;let t=1e3*Math.pow(2,r);await new Promise(e=>setTimeout(e,t));continue}throw e}throw Error("Maximum retry attempts reached")}let s={products:{getAll:async t=>{let e=new URLSearchParams;t&&Object.entries(t).forEach(t=>{let[r,a]=t;void 0!==a&&e.append(r,a.toString())});let r=e.toString(),a="/products".concat(r?"?".concat(r):"");console.log("Fetching products from:",a);let s=await o(a);if(console.log("Products API response:",s),s&&!0===s.success&&s.data&&s.data.products&&Array.isArray(s.data.products)){var n,c,i,d;return console.log("✅ Using server format: success.data.products"),console.log("\uD83D\uDCE6 Products count:",s.data.products.length),console.log("\uD83D\uDCE6 First product name:",(null===(n=s.data.products[0])||void 0===n?void 0:n.name)||"none"),{data:s.data.products,summary:{total:(null===(c=s.data.pagination)||void 0===c?void 0:c.total)||s.data.products.length,page:(null===(i=s.data.pagination)||void 0===i?void 0:i.page)||1,pages:(null===(d=s.data.pagination)||void 0===d?void 0:d.pages)||1}}}return s&&s.products&&Array.isArray(s.products)?(console.log("Using direct products format"),{data:s.products,summary:s.pagination||{total:s.products.length,page:1,pages:1}}):Array.isArray(s)?(console.log("Using direct array format"),{data:s,summary:{total:s.length,page:1,pages:1}}):s&&s.data&&Array.isArray(s.data)?(console.log("Using direct data array format"),{data:s.data,summary:{total:s.data.length,page:1,pages:1}}):(console.error("Unexpected API response format:",s),{data:[],summary:{total:0,page:1,pages:1}})},getById:async t=>o("/products/".concat(t)),getBySlug:async t=>o("/products/".concat(t)),getByCategory:async t=>{let e=await o("/products?category=".concat(t));return(console.log("Products by category API response:",e),e&&!0===e.success&&e.data&&e.data.products&&Array.isArray(e.data.products))?(console.log("✅ Using server format: success.data.products"),e.data.products):(console.error("❌ Unexpected API response format:",e),[])},getPopular:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return o("/products?isFeatured=true&limit=".concat(t))},getNew:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return o("/products?isBrandNew=true&limit=".concat(t))},getOnSale:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return o("/products?isOnSale=true&limit=".concat(t))},search:async t=>{let e=await o("/products?search=".concat(encodeURIComponent(t)));return(console.log("Search API response:",e),e&&!0===e.success&&e.data&&e.data.products&&Array.isArray(e.data.products))?(console.log("✅ Using server format: success.data.products"),e.data.products):(console.error("❌ Unexpected API response format:",e),[])}},cart:{get:async()=>o("/cart"),add:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return o("/cart/add",{method:"POST",body:JSON.stringify({productId:t,quantity:e,size:r,color:a})})},update:async(t,e,r,a)=>o("/cart/".concat(t),{method:"PUT",body:JSON.stringify({quantity:e,size:r,color:a})}),remove:async(t,e,r)=>o("/cart/".concat(t),{method:"DELETE",body:JSON.stringify({size:e,color:r})}),clear:async()=>o("/cart",{method:"DELETE"})},favorites:{get:async()=>o("/favorites"),add:async t=>o("/favorites",{method:"POST",body:JSON.stringify({productId:t})}),remove:async t=>o("/favorites/".concat(t),{method:"DELETE"}),check:async t=>o("/favorites/check/".concat(t))},auth:{register:async(t,e,r,a)=>o("/auth/register",{method:"POST",body:JSON.stringify({firstName:t,lastName:e,email:r,password:a})}),login:async(t,e)=>o("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:e})}),logout:async()=>o("/auth/logout",{method:"POST"}),getProfile:async()=>o("/auth/profile"),updateProfile:async(t,e,r)=>o("/auth/profile",{method:"PUT",body:JSON.stringify({firstName:t,lastName:e,email:r})}),changePassword:async(t,e)=>o("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:t,newPassword:e})}),forgotPassword:async t=>o("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:t})}),resetPassword:async(t,e)=>o("/auth/reset-password",{method:"POST",body:JSON.stringify({token:t,password:e})})},categories:{getAll:async()=>{let t=await o("/categories");return t.success&&t.data&&t.data.categories?t.data.categories:Array.isArray(t)?t:[]},getBySlug:async t=>{let e=await o("/categories/".concat(t));return e.success&&e.data&&e.data.category?e.data.category:e}},orders:{create:async(t,e)=>o("/orders",{method:"POST",body:JSON.stringify({items:t,shippingAddress:e})}),getUserOrders:async()=>o("/orders"),getOrderById:async t=>o("/orders/".concat(t))}}},9311:function(t,e,r){r.d(e,{cn:function(){return s}});var a=r(7042),o=r(4769);function s(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return(0,o.m6)((0,a.W)(e))}}}]);