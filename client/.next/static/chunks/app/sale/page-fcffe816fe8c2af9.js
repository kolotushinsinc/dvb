(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{1291:function(e,r,t){"use strict";t.d(r,{Z:function(){return l}});var s=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7158:function(e,r,t){"use strict";t.d(r,{Z:function(){return l}});var s=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},8063:function(e,r,t){"use strict";t.d(r,{Z:function(){return l}});var s=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s.Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},4891:function(e,r,t){"use strict";t.d(r,{Z:function(){return l}});var s=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s.Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},9883:function(e,r,t){"use strict";t.d(r,{Z:function(){return l}});var s=t(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},862:function(e,r,t){Promise.resolve().then(t.bind(t,7840))},7840:function(e,r,t){"use strict";t.r(r);var s=t(7437),l=t(2265),a=t(1088),c=t(1517),o=t(7478),n=t(3023),i=t(8094),d=t(7810),h=t(9670),x=t(5340),u=t(1827),m=t(1980),g=t(1609),p=t(1424),f=t(1396),y=t.n(f),j=t(164),v=t(7960),N=t(9613),b=t(1002),w=t(6036),k=t(3241);r.default=()=>{var e;let[r,t]=(0,l.useState)([]),[f,A]=(0,l.useState)([]),{categories:P}=(0,o.L)(),[C,_]=(0,l.useState)(!0),[S,Z]=(0,l.useState)(null),[I,M]=(0,l.useState)([0,15e3]),[z,F]=(0,l.useState)([]),[E,Q]=(0,l.useState)([]),[U,B]=(0,l.useState)("discount"),{toggleFavorite:O,isFavorite:R,isLoggedIn:L,showAuthModal:q,setShowAuthModal:D}=(0,g.r)();(0,l.useEffect)(()=>{let e=async()=>{try{_(!0);let e=await j.h.products.getAll();console.log("Products response:",e);let r=[];if(!e){console.error("Products response is null or undefined"),t([]),A([]),Z("Ошибка загрузки товаров"),_(!1);return}if(e&&e.data&&Array.isArray(e.data))r=e.data,console.log("Using api.products.getAll format");else if(e&&!0===e.success&&e.data&&e.data.products&&Array.isArray(e.data.products))r=e.data.products,console.log("Using nested data.products format");else if(e&&e.products&&Array.isArray(e.products))r=e.products,console.log("Using direct products format");else if(e&&e.data&&Array.isArray(e.data))r=e.data,console.log("Using direct data format");else if(Array.isArray(e))r=e,console.log("Using direct array format");else{console.error("API response format is not recognized:",e),t([]),A([]),Z("Ошибка загрузки товаров"),_(!1);return}let s=r.filter(e=>e.isOnSale);if(!s||0===s.length){console.warn("No sale products found in API response"),t([]),A([]),Z("Товары со скидкой не найдены"),_(!1);return}console.log("Setting products state with:",s.length,"sale products"),t(s),console.log("Setting filteredProducts state with all sale products"),A([...s]),F([]),console.log("All sale products loaded:",s.length),console.log("Active categories:",P.length),Z(null)}catch(e){Z("Не удалось загрузить товары"),console.error("Load error:",e)}finally{_(!1)}};e()},[]);let V=P.map(e=>({id:e._id,slug:e.slug,name:e.name,count:r.filter(r=>r.categoryId&&r.categoryId._id===e._id).length}));Array.from(new Set(r.map(e=>e.country).filter(Boolean))).map(e=>({id:e,name:e,count:r.filter(r=>r.country===e).length}));let X=async(e,r)=>{if(r.preventDefault(),r.stopPropagation(),!L){D(!0);return}try{await O(e._id);let r=R(e._id)?"Товар удален из избранного":"Товар добавлен в избранное";p.Am.success(r)}catch(e){p.Am.error("Не удалось добавить товар в избранное")}},H=e=>new Intl.NumberFormat("ru-RU").format(e)+" ₽",T=(e,r)=>Math.round((e-r)/e*100),G=()=>{if(console.log("Applying filters with selectedCategories:",z),console.log("Applying filters with products:",r),console.log("Applying filters with priceRange:",I),console.log("Applying filters with selectedCountries:",E),!r||0===r.length){console.log("No products to filter"),A([]);return}let e=r.filter(e=>{let r=e.price>=I[0]&&e.price<=I[1],t=!0;z.length>0?e.categoryId&&e.categoryId._id?(t=z.includes(e.categoryId._id),console.log("Product ".concat(e.name,": categoryId=").concat(e.categoryId._id,", categoryMatch=").concat(t))):e.category&&e.category._id?(t=z.includes(e.category._id),console.log("Product ".concat(e.name,": category._id=").concat(e.category._id,", categoryMatch=").concat(t))):(t=!1,console.log("Product ".concat(e.name,": no category, categoryMatch=").concat(t))):console.log("Product ".concat(e.name,": no category filter applied, categoryMatch=").concat(t));let s=0===E.length||e.country&&E.includes(e.country);return console.log("Product ".concat(e.name,": country=").concat(e.country,", selectedCountries=").concat(E,", countryMatch=").concat(s)),console.log("Product ".concat(e.name,": final result - priceMatch=").concat(r,", categoryMatch=").concat(t,", countryMatch=").concat(s)),r&&t&&s});switch(console.log("Filtered products before sorting:",e),U){case"price-low":e=e.sort((e,r)=>e.price-r.price);break;case"price-high":e=e.sort((e,r)=>r.price-e.price);break;case"discount":e=e.sort((e,r)=>{let t=e.originalPrice?T(e.originalPrice,e.price):0,s=r.originalPrice?T(r.originalPrice,r.price):0;return s-t});break;case"rating":e=e.sort((e,r)=>(r.rating||0)-(e.rating||0));break;case"new":e=e.sort((e,r)=>(r.isBrandNew?1:0)-(e.isBrandNew?1:0));break;default:e=e.sort((e,r)=>(r.rating||0)*(r.reviewsCount||0)-(e.rating||0)*(e.reviewsCount||0))}console.log("Final filtered products:",e),A([...e])};return(0,l.useEffect)(()=>{console.log("useEffect triggered for applying filters"),console.log("Products length:",r.length),console.log("Selected categories:",z),console.log("Selected countries:",E),console.log("Price range:",I),console.log("Sort by:",U),r.length>0?(console.log("Applying filters..."),G()):console.log("No products to filter")},[z,E,I,U,r]),(0,l.useEffect)(()=>{console.log("Filtered products updated:",f),console.log("Filtered products length:",null==f?void 0:f.length)},[f]),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-cream-50 to-white",children:[(0,s.jsx)(a.Header,{}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"mb-12 text-center md:text-left",children:[(0,s.jsx)("div",{className:"inline-block mb-4",children:(0,s.jsx)("span",{className:"text-sm text-charcoal-500 uppercase tracking-wider font-medium bg-secondary-50 px-3 py-1 rounded-full",children:"Специальные предложения"})}),(0,s.jsxs)("h1",{className:"font-display text-3xl lg:text-5xl font-bold text-charcoal-800 mb-4 tracking-tight",children:["Распродажа ",(0,s.jsx)("span",{className:"premium-text",children:"коллекция"}),z.length>0&&(0,s.jsxs)("span",{className:"text-2xl font-normal text-charcoal-600 ml-4",children:["(",null===(e=V.find(e=>z.includes(e.id)))||void 0===e?void 0:e.name,")"]})]}),(0,s.jsxs)("p",{className:"text-lg text-charcoal-600 max-w-2xl md:mx-0 mx-auto",children:["Найдено товаров: ",(0,s.jsx)("span",{className:"font-semibold",children:f&&Array.isArray(f)?f.length:0}),0===z.length&&(0,s.jsx)("span",{className:"ml-2",children:"(показаны все категории)"})]})]}),(0,s.jsxs)("div",{className:"flex gap-8",children:[(0,s.jsx)(m.V,{categories:P,products:r,onFilterChange:e=>{F(e.selectedCategories),M(e.priceRange),Q(e.selectedCountries),G()}}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("span",{className:"text-charcoal-600",children:"Сортировать:"}),(0,s.jsxs)(i.Ph,{value:U,onValueChange:B,children:[(0,s.jsx)(i.i4,{className:"w-48 border-secondary-200 bg-secondary-50 focus:border-primary-300 focus:ring-primary-200 focus:bg-white rounded-xl",children:(0,s.jsx)(i.ki,{})}),(0,s.jsxs)(i.Bw,{children:[(0,s.jsx)(i.Ql,{value:"discount",children:"По размеру скидки"}),(0,s.jsx)(i.Ql,{value:"price-low",children:"Цена: по возрастанию"}),(0,s.jsx)(i.Ql,{value:"price-high",children:"Цена: по убыванию"}),(0,s.jsx)(i.Ql,{value:"rating",children:"По рейтингу"}),(0,s.jsx)(i.Ql,{value:"new",children:"Сначала новинки"}),(0,s.jsx)(i.Ql,{value:"popularity",children:"По популярности"})]})]})]}),(0,s.jsx)(n.z,{onClick:G,className:"lg:hidden bg-gradient-to-r from-primary-400 to-primary-500 hover:from-primary-500 hover:to-primary-600 text-primary-900 shadow-lg hover:shadow-xl",children:"Применить фильтры"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:C?Array.from({length:6}).map((e,r)=>(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-secondary-100 h-[400px] flex items-center justify-center",children:(0,s.jsx)(N.Loader,{size:"lg",text:"Загрузка..."})},r)):S?(0,s.jsx)("div",{className:"col-span-full",children:(0,s.jsx)(b.F7,{onRetry:()=>window.location.reload()})}):f&&Array.isArray(f)&&f.length>0?f.map((e,r)=>(0,s.jsx)(v.SlideIn,{delay:50*r,children:(0,s.jsxs)("div",{className:"group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 overflow-hidden border border-secondary-100 premium-shadow",children:[(0,s.jsxs)("div",{className:"relative overflow-hidden bg-secondary-50 h-72",children:[(0,s.jsx)(y(),{href:"/product/".concat(e.slug),children:(0,s.jsx)("img",{src:e.mainImage||"/placeholder-product.jpg",alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),(0,s.jsxs)("div",{className:"absolute top-4 left-4 flex flex-col space-y-2",children:[e.isBrandNew&&(0,s.jsx)("span",{className:"bg-gradient-to-r from-gold-400 to-gold-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-md",children:"НОВОЕ"}),e.isOnSale&&e.originalPrice&&(0,s.jsxs)("span",{className:"bg-gradient-to-r from-accent-500 to-accent-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-md",children:["-",T(e.originalPrice,e.price),"%"]})]}),(0,s.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transform translate-x-4 group-hover:translate-x-0 transition-all duration-300",children:[(0,s.jsx)(n.z,{size:"icon",variant:"secondary",className:"w-11 h-11 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white shadow-lg hover:shadow-xl ".concat(R(e._id)?"text-accent-500 hover:text-accent-600 hover:scale-110 transition-all duration-300":"text-charcoal-600 hover:text-accent-500 hover:scale-110 transition-all duration-300"),onClick:r=>X(e,r),children:(0,s.jsx)(d.Z,{className:"w-5 h-5 ".concat(R(e._id)?"fill-current":"")})}),(0,s.jsx)(k.i,{product:e,children:(0,s.jsx)(n.z,{size:"icon",variant:"secondary",className:"w-11 h-11 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white shadow-lg hover:shadow-xl text-charcoal-600 hover:text-primary-500 hover:scale-110 transition-all duration-300",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,s.jsx)(h.Z,{className:"w-5 h-5"})})})]}),(0,s.jsx)("div",{className:"absolute bottom-4 left-4",children:(0,s.jsx)("span",{className:"bg-white/90 backdrop-blur-sm text-charcoal-700 text-xs px-4 py-1.5 rounded-full font-medium shadow-sm border border-white/50",children:e.country})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-charcoal-500 uppercase tracking-wider font-medium bg-secondary-50 px-3 py-1 rounded-full",children:e.categoryId?e.categoryId.name:e.category?e.category.name:""}),(0,s.jsxs)("div",{className:"flex items-center space-x-1 bg-gold-50 px-2 py-1 rounded-full",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4 fill-gold-500 text-gold-500"}),(0,s.jsx)("span",{className:"text-sm text-charcoal-700 font-medium",children:e.rating||4.5}),(0,s.jsxs)("span",{className:"text-sm text-charcoal-500",children:["(",e.reviewsCount||12,")"]})]})]}),(0,s.jsx)(y(),{href:"/product/".concat(e.slug),children:(0,s.jsx)("h3",{className:"font-heading text-lg font-bold text-charcoal-800 mb-3 group-hover:text-primary-500 transition-colors line-clamp-2 h-14",children:e.name})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-secondary-100",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xl font-bold text-charcoal-800",children:H(e.price)}),e.originalPrice&&(0,s.jsx)("span",{className:"text-sm text-charcoal-500 line-through",children:H(e.originalPrice)})]}),(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary-50 group-hover:bg-primary-100 flex items-center justify-center transition-all",children:(0,s.jsx)("span",{className:"text-sm text-primary-500 group-hover:text-primary-600",children:"→"})})]})]})]})},e._id)):(0,s.jsx)("div",{className:"col-span-full text-center py-16 bg-white rounded-2xl shadow-lg border border-secondary-100 premium-card",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-secondary-50 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,s.jsx)(u.Z,{className:"w-10 h-10 text-secondary-300"})}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-charcoal-800 mb-4",children:"Товары со скидкой не найдены"}),(0,s.jsx)("p",{className:"text-charcoal-600 mb-8",children:"Попробуйте изменить параметры фильтрации или обновить страницу"}),(0,s.jsx)(n.z,{variant:"outline",onClick:()=>{F([]),Q([]),M([0,15e3]),B("discount")},className:"border-2 border-secondary-200 hover:border-primary-300 px-6 py-2",children:"Сбросить фильтры"})]})})})]})]})]}),(0,s.jsx)(w.Q,{isOpen:q,onClose:()=>D(!1),message:"Для добавления товара в избранное необходимо войти в систему"}),(0,s.jsx)(c.Footer,{})]})}},1002:function(e,r,t){"use strict";t.d(r,{F7:function(){return n},TX:function(){return i},Xr:function(){return o}});var s=t(7437);t(2265);var l=t(8063),a=t(2549),c=t(3023);let o=e=>{let{error:r,onDismiss:t,className:o=""}=e;return r?(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 ".concat(o),children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(l.Z,{className:"h-5 w-5 text-red-400"})}),(0,s.jsxs)("div",{className:"ml-3 flex-1",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Ошибка"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,s.jsx)("p",{children:r})})]}),t&&(0,s.jsx)("div",{className:"ml-auto pl-3",children:(0,s.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,s.jsx)(c.z,{variant:"ghost",size:"sm",onClick:t,className:"text-red-500 hover:text-red-700",children:(0,s.jsx)(a.Z,{className:"h-4 w-4"})})})})]})}):null},n=e=>{let{onRetry:r,className:t=""}=e;return(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 ".concat(t),children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(l.Z,{className:"h-5 w-5 text-yellow-400"})}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Проблема с подключением"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,s.jsx)("p",{children:"Не удалось подключиться к серверу. Пожалуйста, проверьте ваше интернет-соединение."})}),r&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:r,className:"text-yellow-700 border-yellow-300 hover:bg-yellow-100",children:"Попробовать снова"})})]})]})})},i=e=>{let{message:r="Страница не найдена",className:t=""}=e;return(0,s.jsx)("div",{className:"min-h-[400px] flex items-center justify-center ".concat(t),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-6xl font-bold text-gray-900",children:"404"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:r})]})})}}},function(e){e.O(0,[312,85,787,10,148,548,631,980,971,864,560],function(){return e(e.s=862)}),_N_E=e.O()}]);