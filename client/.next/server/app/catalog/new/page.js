(()=>{var e={};e.id=4959,e.ids=[4959],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6507:(e,s,l)=>{"use strict";l.r(s),l.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>h,pages:()=>x,routeModule:()=>g,tree:()=>d});var t=l(3137),a=l(4647),r=l(4183),i=l.n(r),n=l(1775),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);l.d(s,c);let o=t.AppPageRouteModule,d=["",{children:["catalog",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(l.bind(l,9373)),"/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/catalog/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(l.bind(l,7613)),"/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(l.t.bind(l,1918,23)),"next/dist/client/components/not-found-error"]}],x=["/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/catalog/new/page.tsx"],h="/catalog/new/page",m={require:l,loadChunk:()=>Promise.resolve()},g=new o({definition:{kind:a.x.APP_PAGE,page:"/catalog/new/page",pathname:"/catalog/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1337:(e,s,l)=>{Promise.resolve().then(l.bind(l,3482))},3482:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>P});var t=l(80),a=l(9885),r=l(9006),i=l(3507),n=l(8384),c=l(3780),o=l(589),d=l(8971),x=l(2029),h=l(6206),m=l(7371),g=l(8626),u=l(7932),p=l(5894),j=l(442),f=l(9941),v=l(1440),N=l.n(v),y=l(7936),b=l(1157),w=l(997),k=l(8632);let P=()=>{let[e,s]=(0,a.useState)([]),[l,v]=(0,a.useState)([]),[P,_]=(0,a.useState)([]),[A,C]=(0,a.useState)(!0),[S,q]=(0,a.useState)(null),[z,B]=(0,a.useState)([0,15e3]),[$,E]=(0,a.useState)([]),[F,M]=(0,a.useState)([]),[Z,Q]=(0,a.useState)("popularity"),[T,U]=(0,a.useState)(!1),{addItem:G}=(0,j.j)();(0,a.useEffect)(()=>{let e=async()=>{try{C(!0);let e=await y.h.categories.getAll();console.log("Categories response:",e);let l=e.filter(e=>e.isActive),t=l.map(e=>e.slug);_(l);let a=await y.h.products.getAll();console.log("Products response:",a);let r=a.data;console.log("Active category slugs:",t),console.log("All products:",r);let i=r.filter(e=>e.category&&t.includes(e.category.slug)&&e.isBrandNew);console.log("Filtered products:",i),s(i),v(i),q(null)}catch(e){q("Не удалось загрузить товары"),console.error("Product load error:",e)}finally{C(!1)}};e()},[]);let K=Array.from(new Set(e.map(e=>e.category?.slug).filter(Boolean))).map(s=>{let l=P.find(e=>e.slug===s);return{id:s,name:l?.name||s,count:e.filter(e=>e.category?.slug===s).length}}),X=Array.from(new Set(e.map(e=>e.country).filter(Boolean))).map(s=>({id:s,name:s,count:e.filter(e=>e.country===s).length})),I=(e,s)=>{E(l=>s?[...l,e]:l.filter(s=>s!==e))},R=(e,s)=>{M(l=>s?[...l,e]:l.filter(s=>s!==e))},V=(e,s)=>{s.preventDefault(),s.stopPropagation(),G(e),f.Am.success("Товар добавлен в корзину!")},D=e=>new Intl.NumberFormat("ru-RU").format(e)+" ₽",O=()=>{let s=e.filter(e=>{let s=e.price>=z[0]&&e.price<=z[1],l=0===$.length||e.category&&$.includes(e.category.slug),t=0===F.length||e.country&&F.includes(e.country);return s&&l&&t});switch(Z){case"price-low":s=s.sort((e,s)=>e.price-s.price);break;case"price-high":s=s.sort((e,s)=>s.price-e.price);break;case"rating":s=s.sort((e,s)=>(s.rating||0)-(e.rating||0));break;case"new":s=s.sort((e,s)=>(s.isBrandNew?1:0)-(e.isBrandNew?1:0));break;default:s=s.sort((e,s)=>(s.rating||0)*(s.reviews?.length||0)-(e.rating||0)*(e.reviews?.length||0))}v(s)};(0,a.useEffect)(()=>{O()},[$,F,z,Z,l]);let H=()=>{E([]),M([]),B([0,15e3]),Q("popularity")};return(0,t.jsxs)("div",{className:"min-h-screen bg-cream-50",children:[t.jsx(r.default,{}),(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[t.jsx("h1",{className:"font-display text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Новинки"}),(0,t.jsxs)("p",{className:"text-lg text-gray-600",children:["Найдено товаров: ",l.length]})]}),(0,t.jsxs)("div",{className:"flex gap-8",children:[t.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:t.jsx(n.z,{onClick:()=>U(!T),className:"rounded-full shadow-lg",size:"lg",children:t.jsx(x.Z,{className:"w-5 h-5"})})}),(0,t.jsxs)("div",{className:`${T?"fixed inset-0 z-40 bg-white p-6 overflow-y-auto":"hidden"} lg:block lg:w-64 flex-shrink-0`,children:[(0,t.jsxs)("div",{className:"lg:hidden flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-xl font-bold",children:"Фильтры"}),t.jsx(n.z,{variant:"ghost",size:"sm",onClick:()=>U(!1),children:t.jsx(h.Z,{className:"h-5 w-5"})})]}),t.jsx(()=>(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Цена"}),(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx(o.i,{value:z,onValueChange:B,max:15e3,step:100,className:"w-full"}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsx("span",{children:D(z[0])}),t.jsx("span",{children:D(z[1])})]})]})]}),(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Категории"}),t.jsx("div",{className:"space-y-3",children:K.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx(c.X,{id:e.id,checked:!!e.id&&$.includes(e.id),onCheckedChange:s=>e.id&&I(e.id,s)}),(0,t.jsxs)("label",{htmlFor:e.id,className:"flex-1 text-sm cursor-pointer",children:[e.name,(0,t.jsxs)("span",{className:"text-gray-400 ml-1",children:["(",e.count,")"]})]})]},e.id))})]}),(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Страна производитель"}),t.jsx("div",{className:"space-y-3",children:X.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx(c.X,{id:e.id||"",checked:!!e.id&&F.includes(e.id),onCheckedChange:s=>e.id&&R(e.id,s)}),(0,t.jsxs)("label",{htmlFor:e.id||"",className:"flex-1 text-sm cursor-pointer",children:[e.name,(0,t.jsxs)("span",{className:"text-gray-400 ml-1",children:["(",e.count,")"]})]})]},e.id))})]}),t.jsx(n.z,{onClick:H,variant:"outline",className:"w-full",children:"Очистить фильтры"})]}),{})]}),(0,t.jsxs)("div",{className:"flex-1",children:[t.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[t.jsx("span",{className:"text-gray-600",children:"Сортировка:"}),(0,t.jsxs)(d.Ph,{value:Z,onValueChange:Q,children:[t.jsx(d.i4,{className:"w-48",children:t.jsx(d.ki,{placeholder:"Выберите сортировку"})}),(0,t.jsxs)(d.Bw,{children:[t.jsx(d.Ql,{value:"popularity",children:"По популярности"}),t.jsx(d.Ql,{value:"price-low",children:"Сначала дешевые"}),t.jsx(d.Ql,{value:"price-high",children:"Сначала дорогие"}),t.jsx(d.Ql,{value:"rating",children:"По рейтингу"}),t.jsx(d.Ql,{value:"new",children:"Сначала новинки"})]})]})]})}),A?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,s)=>t.jsx(w.mA,{},s))}):S?t.jsx(k.Xr,{error:S}):0===l.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Товары не найдены"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Попробуйте изменить параметры фильтрации"}),t.jsx(n.z,{onClick:H,children:"Очистить фильтры"})]}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(e=>t.jsx(b.FadeIn,{className:"group",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md",children:[(0,t.jsxs)("div",{className:"relative",children:[t.jsx(N(),{href:`/product/${e.slug}`,children:t.jsx("div",{className:"aspect-square overflow-hidden",children:t.jsx("img",{src:e.images[0]?.url||"/placeholder-product.png",alt:e.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})})}),(0,t.jsxs)("div",{className:"absolute top-3 left-3 flex space-x-2",children:[e.isBrandNew&&t.jsx("span",{className:"bg-blue-500 text-white text-xs font-semibold px-2 py-1 rounded-full",children:"Новинка"}),e.originalPrice&&e.originalPrice>e.price&&(0,t.jsxs)("span",{className:"bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded-full",children:["-",Math.round((1-e.price/e.originalPrice)*100),"%"]})]}),(0,t.jsxs)("div",{className:"absolute top-3 right-3 flex flex-col space-y-2",children:[t.jsx("button",{className:"bg-white rounded-full p-2 shadow-md hover:bg-gray-100 transition-colors",children:t.jsx(m.Z,{className:"h-4 w-4 text-gray-600"})}),t.jsx("button",{className:"bg-white rounded-full p-2 shadow-md hover:bg-gray-100 transition-colors",children:t.jsx(g.Z,{className:"h-4 w-4 text-gray-600"})})]})]}),(0,t.jsxs)("div",{className:"p-5",children:[t.jsx("div",{className:"mb-2",children:e.category&&t.jsx(N(),{href:`/catalog/${e.category.slug}`,children:t.jsx("span",{className:"text-xs text-gray-500 hover:text-gray-700",children:e.category.name})})}),t.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:t.jsx(N(),{href:`/product/${e.slug}`,className:"hover:text-blue-600 transition-colors",children:e.name})}),(0,t.jsxs)("div",{className:"flex items-center mb-3",children:[t.jsx("div",{className:"flex items-center",children:[void 0,void 0,void 0,void 0,void 0].map((s,l)=>t.jsx(u.Z,{className:`h-4 w-4 ${l<Math.floor(e.rating||0)?"text-yellow-400 fill-current":"text-gray-300"}`},l))}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:[e.rating?.toFixed(1)||"0.0"," (",e.reviews?.length||0," отзывов)"]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:e.originalPrice&&e.originalPrice>e.price?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-lg font-bold text-red-600",children:D(e.price)}),t.jsx("span",{className:"text-sm text-gray-500 line-through",children:D(e.originalPrice)})]}):t.jsx("span",{className:"text-lg font-bold text-gray-900",children:D(e.price)})}),t.jsx(n.z,{size:"sm",onClick:s=>V(e,s),className:"rounded-full p-2",children:t.jsx(p.Z,{className:"h-4 w-4"})})]})]})]})},e._id))})]})]})]}),t.jsx(i.default,{})]})}},9373:(e,s,l)=>{"use strict";l.r(s),l.d(s,{$$typeof:()=>i,__esModule:()=>r,default:()=>c});var t=l(7536);let a=(0,t.createProxy)(String.raw`/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/catalog/new/page.tsx`),{__esModule:r,$$typeof:i}=a,n=a.default,c=n}};var s=require("../../../webpack-runtime.js");s.C(e);var l=e=>s(s.s=e),t=s.X(0,[6498,7001,7240,1913,8055,1788,1590,6606,997,8632],()=>l(6507));module.exports=t})();