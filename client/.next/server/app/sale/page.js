(()=>{var e={};e.id=744,e.ids=[744],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3917:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});var s=t(2125);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s.Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},9986:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.a,__next_app__:()=>g,originalPathname:()=>h,pages:()=>u,routeModule:()=>p,tree:()=>d});var s=t(3137),a=t(4647),l=t(4183),o=t.n(l),n=t(1775),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(r,c);let i=s.AppPageRouteModule,d=["",{children:["sale",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,7862)),"/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/sale/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1335)),"/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,1918,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/sale/page.tsx"],h="/sale/page",g={require:t,loadChunk:()=>Promise.resolve()},p=new i({definition:{kind:a.x.APP_PAGE,page:"/sale/page",pathname:"/sale",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1517:(e,r,t)=>{Promise.resolve().then(t.bind(t,7288))},7288:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>A});var s=t(80),a=t(9885),l=t(9006),o=t(3507),n=t(8106),c=t(8384),i=t(8971),d=t(7371),u=t(8626),h=t(7932),g=t(9518),p=t(4653),x=t(8931),m=t(9941),f=t(1440),y=t.n(f),j=t(7936),b=t(1157),v=t(997),w=t(8632),N=t(5479),P=t(7372);let A=()=>{let[e,r]=(0,a.useState)([]),[t,f]=(0,a.useState)([]),{categories:A}=(0,n.L)(),[k,_]=(0,a.useState)(!0),[$,C]=(0,a.useState)(null),[S,I]=(0,a.useState)([0,15e3]),[M,q]=(0,a.useState)([]),[U,z]=(0,a.useState)([]),[E,F]=(0,a.useState)("discount"),{toggleFavorite:Q,isFavorite:Z,isLoggedIn:B,showAuthModal:R,setShowAuthModal:T}=(0,x.r)();(0,a.useEffect)(()=>{let e=async()=>{try{_(!0);let e=await j.h.products.getAll();console.log("Products response:",e);let t=[];if(!e){console.error("Products response is null or undefined"),r([]),f([]),C("Ошибка загрузки товаров"),_(!1);return}if(e&&e.data&&Array.isArray(e.data))t=e.data,console.log("Using api.products.getAll format");else if(e&&!0===e.success&&e.data&&e.data.products&&Array.isArray(e.data.products))t=e.data.products,console.log("Using nested data.products format");else if(e&&e.products&&Array.isArray(e.products))t=e.products,console.log("Using direct products format");else if(e&&e.data&&Array.isArray(e.data))t=e.data,console.log("Using direct data format");else if(Array.isArray(e))t=e,console.log("Using direct array format");else{console.error("API response format is not recognized:",e),r([]),f([]),C("Ошибка загрузки товаров"),_(!1);return}let s=t.filter(e=>e.isOnSale);if(!s||0===s.length){console.warn("No sale products found in API response"),r([]),f([]),C("Товары со скидкой не найдены"),_(!1);return}console.log("Setting products state with:",s.length,"sale products"),r(s),console.log("Setting filteredProducts state with all sale products"),f([...s]),q([]),console.log("All sale products loaded:",s.length),console.log("Active categories:",A.length),C(null)}catch(e){C("Не удалось загрузить товары"),console.error("Load error:",e)}finally{_(!1)}};e()},[]);let G=A.map(r=>({id:r._id,slug:r.slug,name:r.name,count:e.filter(e=>e.categoryId&&e.categoryId._id===r._id).length}));Array.from(new Set(e.map(e=>e.country).filter(Boolean))).map(r=>({id:r,name:r,count:e.filter(e=>e.country===r).length}));let K=async(e,r)=>{if(r.preventDefault(),r.stopPropagation(),!B){T(!0);return}try{await Q(e._id);let r=Z(e._id)?"Товар удален из избранного":"Товар добавлен в избранное";m.Am.success(r)}catch(e){m.Am.error("Не удалось добавить товар в избранное")}},O=e=>new Intl.NumberFormat("ru-RU").format(e)+" ₽",L=(e,r)=>Math.round((e-r)/e*100),D=()=>{if(console.log("Applying filters with selectedCategories:",M),console.log("Applying filters with products:",e),console.log("Applying filters with priceRange:",S),console.log("Applying filters with selectedCountries:",U),!e||0===e.length){console.log("No products to filter"),f([]);return}let r=e.filter(e=>{let r=e.price>=S[0]&&e.price<=S[1],t=!0;M.length>0?e.categoryId&&e.categoryId._id?console.log(`Product ${e.name}: categoryId=${e.categoryId._id}, categoryMatch=${t=M.includes(e.categoryId._id)}`):e.category&&e.category._id?console.log(`Product ${e.name}: category._id=${e.category._id}, categoryMatch=${t=M.includes(e.category._id)}`):console.log(`Product ${e.name}: no category, categoryMatch=${t=!1}`):console.log(`Product ${e.name}: no category filter applied, categoryMatch=${t}`);let s=0===U.length||e.country&&U.includes(e.country);return console.log(`Product ${e.name}: country=${e.country}, selectedCountries=${U}, countryMatch=${s}`),console.log(`Product ${e.name}: final result - priceMatch=${r}, categoryMatch=${t}, countryMatch=${s}`),r&&t&&s});switch(console.log("Filtered products before sorting:",r),E){case"price-low":r=r.sort((e,r)=>e.price-r.price);break;case"price-high":r=r.sort((e,r)=>r.price-e.price);break;case"discount":r=r.sort((e,r)=>{let t=e.originalPrice?L(e.originalPrice,e.price):0,s=r.originalPrice?L(r.originalPrice,r.price):0;return s-t});break;case"rating":r=r.sort((e,r)=>(r.rating||0)-(e.rating||0));break;case"new":r=r.sort((e,r)=>(r.isBrandNew?1:0)-(e.isBrandNew?1:0));break;default:r=r.sort((e,r)=>(r.rating||0)*(r.reviewsCount||0)-(e.rating||0)*(e.reviewsCount||0))}console.log("Final filtered products:",r),f([...r])};return(0,a.useEffect)(()=>{console.log("useEffect triggered for applying filters"),console.log("Products length:",e.length),console.log("Selected categories:",M),console.log("Selected countries:",U),console.log("Price range:",S),console.log("Sort by:",E),e.length>0?(console.log("Applying filters..."),D()):console.log("No products to filter")},[M,U,S,E,e]),(0,a.useEffect)(()=>{console.log("Filtered products updated:",t),console.log("Filtered products length:",t?.length)},[t]),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-cream-50 to-white",children:[s.jsx(l.Header,{}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"mb-12 text-center md:text-left",children:[s.jsx("div",{className:"inline-block mb-4",children:s.jsx("span",{className:"text-sm text-charcoal-500 uppercase tracking-wider font-medium bg-secondary-50 px-3 py-1 rounded-full",children:"Специальные предложения"})}),(0,s.jsxs)("h1",{className:"font-display text-3xl lg:text-5xl font-bold text-charcoal-800 mb-4 tracking-tight",children:["Распродажа ",s.jsx("span",{className:"premium-text",children:"коллекция"}),M.length>0&&(0,s.jsxs)("span",{className:"text-2xl font-normal text-charcoal-600 ml-4",children:["(",G.find(e=>M.includes(e.id))?.name,")"]})]}),(0,s.jsxs)("p",{className:"text-lg text-charcoal-600 max-w-2xl md:mx-0 mx-auto",children:["Найдено товаров: ",s.jsx("span",{className:"font-semibold",children:t&&Array.isArray(t)?t.length:0}),0===M.length&&s.jsx("span",{className:"ml-2",children:"(показаны все категории)"})]})]}),(0,s.jsxs)("div",{className:"flex gap-8",children:[s.jsx(p.V,{categories:A,products:e,onFilterChange:e=>{q(e.selectedCategories),I(e.priceRange),z(e.selectedCountries),D()}}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx("span",{className:"text-charcoal-600",children:"Сортировать:"}),(0,s.jsxs)(i.Ph,{value:E,onValueChange:F,children:[s.jsx(i.i4,{className:"w-48 border-secondary-200 bg-secondary-50 focus:border-primary-300 focus:ring-primary-200 focus:bg-white rounded-xl",children:s.jsx(i.ki,{})}),(0,s.jsxs)(i.Bw,{children:[s.jsx(i.Ql,{value:"discount",children:"По размеру скидки"}),s.jsx(i.Ql,{value:"price-low",children:"Цена: по возрастанию"}),s.jsx(i.Ql,{value:"price-high",children:"Цена: по убыванию"}),s.jsx(i.Ql,{value:"rating",children:"По рейтингу"}),s.jsx(i.Ql,{value:"new",children:"Сначала новинки"}),s.jsx(i.Ql,{value:"popularity",children:"По популярности"})]})]})]}),s.jsx(c.z,{onClick:D,className:"lg:hidden bg-gradient-to-r from-primary-400 to-primary-500 hover:from-primary-500 hover:to-primary-600 text-primary-900 shadow-lg hover:shadow-xl",children:"Применить фильтры"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:k?Array.from({length:6}).map((e,r)=>s.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-secondary-100 h-[400px] flex items-center justify-center",children:s.jsx(v.Loader,{size:"lg",text:"Загрузка..."})},r)):$?s.jsx("div",{className:"col-span-full",children:s.jsx(w.F7,{onRetry:()=>window.location.reload()})}):t&&Array.isArray(t)&&t.length>0?t.map((e,r)=>s.jsx(b.SlideIn,{delay:50*r,children:(0,s.jsxs)("div",{className:"group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 overflow-hidden border border-secondary-100 premium-shadow",children:[(0,s.jsxs)("div",{className:"relative overflow-hidden bg-secondary-50 h-72",children:[s.jsx(y(),{href:`/product/${e.slug}`,children:s.jsx("img",{src:e.mainImage||"/placeholder-product.jpg",alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),(0,s.jsxs)("div",{className:"absolute top-4 left-4 flex flex-col space-y-2",children:[e.isBrandNew&&s.jsx("span",{className:"bg-gradient-to-r from-gold-400 to-gold-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-md",children:"НОВОЕ"}),e.isOnSale&&e.originalPrice&&(0,s.jsxs)("span",{className:"bg-gradient-to-r from-accent-500 to-accent-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-md",children:["-",L(e.originalPrice,e.price),"%"]})]}),(0,s.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transform translate-x-4 group-hover:translate-x-0 transition-all duration-300",children:[s.jsx(c.z,{size:"icon",variant:"secondary",className:`w-11 h-11 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white shadow-lg hover:shadow-xl ${Z(e._id)?"text-accent-500 hover:text-accent-600 hover:scale-110 transition-all duration-300":"text-charcoal-600 hover:text-accent-500 hover:scale-110 transition-all duration-300"}`,onClick:r=>K(e,r),children:s.jsx(d.Z,{className:`w-5 h-5 ${Z(e._id)?"fill-current":""}`})}),s.jsx(P.i,{product:e,children:s.jsx(c.z,{size:"icon",variant:"secondary",className:"w-11 h-11 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white shadow-lg hover:shadow-xl text-charcoal-600 hover:text-primary-500 hover:scale-110 transition-all duration-300",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:s.jsx(u.Z,{className:"w-5 h-5"})})})]}),s.jsx("div",{className:"absolute bottom-4 left-4",children:s.jsx("span",{className:"bg-white/90 backdrop-blur-sm text-charcoal-700 text-xs px-4 py-1.5 rounded-full font-medium shadow-sm border border-white/50",children:e.country})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm text-charcoal-500 uppercase tracking-wider font-medium bg-secondary-50 px-3 py-1 rounded-full",children:e.categoryId?e.categoryId.name:e.category?e.category.name:""}),(0,s.jsxs)("div",{className:"flex items-center space-x-1 bg-gold-50 px-2 py-1 rounded-full",children:[s.jsx(h.Z,{className:"w-4 h-4 fill-gold-500 text-gold-500"}),s.jsx("span",{className:"text-sm text-charcoal-700 font-medium",children:e.rating||4.5}),(0,s.jsxs)("span",{className:"text-sm text-charcoal-500",children:["(",e.reviewsCount||12,")"]})]})]}),s.jsx(y(),{href:`/product/${e.slug}`,children:s.jsx("h3",{className:"font-heading text-lg font-bold text-charcoal-800 mb-3 group-hover:text-primary-500 transition-colors line-clamp-2 h-14",children:e.name})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-secondary-100",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-xl font-bold text-charcoal-800",children:O(e.price)}),e.originalPrice&&s.jsx("span",{className:"text-sm text-charcoal-500 line-through",children:O(e.originalPrice)})]}),s.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-50 group-hover:bg-primary-100 flex items-center justify-center transition-all",children:s.jsx("span",{className:"text-sm text-primary-500 group-hover:text-primary-600",children:"→"})})]})]})]})},e._id)):s.jsx("div",{className:"col-span-full text-center py-16 bg-white rounded-2xl shadow-lg border border-secondary-100 premium-card",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[s.jsx("div",{className:"w-20 h-20 bg-secondary-50 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(g.Z,{className:"w-10 h-10 text-secondary-300"})}),s.jsx("h3",{className:"text-2xl font-bold text-charcoal-800 mb-4",children:"Товары со скидкой не найдены"}),s.jsx("p",{className:"text-charcoal-600 mb-8",children:"Попробуйте изменить параметры фильтрации или обновить страницу"}),s.jsx(c.z,{variant:"outline",onClick:()=>{q([]),z([]),I([0,15e3]),F("discount")},className:"border-2 border-secondary-200 hover:border-primary-300 px-6 py-2",children:"Сбросить фильтры"})]})})})]})]})]}),s.jsx(N.Q,{isOpen:R,onClose:()=>T(!1),message:"Для добавления товара в избранное необходимо войти в систему"}),s.jsx(o.Footer,{})]})}},7862:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>o,__esModule:()=>l,default:()=>c});var s=t(7536);let a=(0,s.createProxy)(String.raw`/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/sale/page.tsx`),{__esModule:l,$$typeof:o}=a,n=a.default,c=n}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[79,1714,7240,24,1913,9807,1590,1260,7372,6606,8632,4653],()=>t(9986));module.exports=s})();