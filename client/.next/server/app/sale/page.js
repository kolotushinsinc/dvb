(()=>{var e={};e.id=744,e.ids=[744],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3917:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});var l=t(2125);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,l.Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},9986:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>g,routeModule:()=>h,tree:()=>d});var l=t(3137),r=t(4647),a=t(4183),i=t.n(a),n=t(1775),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(s,o);let c=l.AppPageRouteModule,d=["",{children:["sale",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,7862)),"/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/sale/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,7613)),"/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,1918,23)),"next/dist/client/components/not-found-error"]}],g=["/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/sale/page.tsx"],x="/sale/page",u={require:t,loadChunk:()=>Promise.resolve()},h=new c({definition:{kind:r.x.APP_PAGE,page:"/sale/page",pathname:"/sale",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1517:(e,s,t)=>{Promise.resolve().then(t.bind(t,7288))},7288:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var l=t(80),r=t(9885),a=t(9006),i=t(3507),n=t(8384),o=t(3780),c=t(589),d=t(8971),g=t(2029),x=t(6206),u=t(7371),h=t(8626),p=t(7932),m=t(8931),f=t(9941),y=t(1440),j=t.n(y),v=t(7936),N=t(1157),b=t(997),w=t(8632),P=t(5479),k=t(7372);let A=()=>{let[e,s]=(0,r.useState)([]),[t,y]=(0,r.useState)([]),[A,_]=(0,r.useState)([]),[$,C]=(0,r.useState)(!0),[S,z]=(0,r.useState)(null),[I,M]=(0,r.useState)([0,15e3]),[q,U]=(0,r.useState)([]),[E,F]=(0,r.useState)([]),[Q,Z]=(0,r.useState)("discount"),[B,T]=(0,r.useState)(!1),{toggleFavorite:G,isFavorite:K,isLoggedIn:O,showAuthModal:R,setShowAuthModal:D}=(0,m.r)();(0,r.useEffect)(()=>{let e=async()=>{try{C(!0);let[e,t]=await Promise.all([v.h.categories.getAll(),v.h.products.getAll()]);console.log("Categories response:",e),console.log("Products response:",t);let l=e.filter(e=>e.isActive);_(l);let r=[];if(!t){console.error("Products response is null or undefined"),s([]),y([]),z("Ошибка загрузки товаров"),C(!1);return}if(t&&t.data&&Array.isArray(t.data))r=t.data,console.log("Using api.products.getAll format");else if(t&&!0===t.success&&t.data&&t.data.products&&Array.isArray(t.data.products))r=t.data.products,console.log("Using nested data.products format");else if(t&&t.products&&Array.isArray(t.products))r=t.products,console.log("Using direct products format");else if(t&&t.data&&Array.isArray(t.data))r=t.data,console.log("Using direct data format");else if(Array.isArray(t))r=t,console.log("Using direct array format");else{console.error("API response format is not recognized:",t),s([]),y([]),z("Ошибка загрузки товаров"),C(!1);return}let a=r.filter(e=>e.isOnSale);if(!a||0===a.length){console.warn("No sale products found in API response"),s([]),y([]),z("Товары со скидкой не найдены"),C(!1);return}console.log("Setting products state with:",a.length,"sale products"),s(a),console.log("Setting filteredProducts state with all sale products"),y([...a]),U([]),console.log("All sale products loaded:",a.length),console.log("Active categories:",l.length),z(null)}catch(e){z("Не удалось загрузить товары"),console.error("Load error:",e)}finally{C(!1)}};e()},[]);let X=A.map(s=>({id:s._id,slug:s.slug,name:s.name,count:e.filter(e=>e.categoryId&&e.categoryId._id===s._id).length})),V=Array.from(new Set(e.map(e=>e.country).filter(Boolean))).map(s=>({id:s,name:s,count:e.filter(e=>e.country===s).length})),L=(e,s)=>{U(t=>s?[...t,e]:t.filter(s=>s!==e))},W=e=>{let s=A.find(s=>s.slug===e);s&&(q.includes(s._id)?U([]):U([s._id]))},H=(e,s)=>{F(t=>s?[...t,e]:t.filter(s=>s!==e))},J=async(e,s)=>{if(s.preventDefault(),s.stopPropagation(),!O){D(!0);return}try{await G(e._id);let s=K(e._id)?"Товар удален из избранного":"Товар добавлен в избранное";f.Am.success(s)}catch(e){f.Am.error("Не удалось добавить товар в избранное")}},Y=e=>new Intl.NumberFormat("ru-RU").format(e)+" ₽",ee=(e,s)=>Math.round((e-s)/e*100),es=()=>{if(console.log("Applying filters with selectedCategories:",q),console.log("Applying filters with products:",e),console.log("Applying filters with priceRange:",I),console.log("Applying filters with selectedCountries:",E),!e||0===e.length){console.log("No products to filter"),y([]);return}let s=e.filter(e=>{let s=e.price>=I[0]&&e.price<=I[1],t=!0;q.length>0?e.categoryId&&e.categoryId._id?console.log(`Product ${e.name}: categoryId=${e.categoryId._id}, categoryMatch=${t=q.includes(e.categoryId._id)}`):e.category&&e.category._id?console.log(`Product ${e.name}: category._id=${e.category._id}, categoryMatch=${t=q.includes(e.category._id)}`):console.log(`Product ${e.name}: no category, categoryMatch=${t=!1}`):console.log(`Product ${e.name}: no category filter applied, categoryMatch=${t}`);let l=0===E.length||e.country&&E.includes(e.country);return console.log(`Product ${e.name}: country=${e.country}, selectedCountries=${E}, countryMatch=${l}`),console.log(`Product ${e.name}: final result - priceMatch=${s}, categoryMatch=${t}, countryMatch=${l}`),s&&t&&l});switch(console.log("Filtered products before sorting:",s),Q){case"price-low":s=s.sort((e,s)=>e.price-s.price);break;case"price-high":s=s.sort((e,s)=>s.price-e.price);break;case"discount":s=s.sort((e,s)=>{let t=e.originalPrice?ee(e.originalPrice,e.price):0,l=s.originalPrice?ee(s.originalPrice,s.price):0;return l-t});break;case"rating":s=s.sort((e,s)=>(s.rating||0)-(e.rating||0));break;case"new":s=s.sort((e,s)=>(s.isBrandNew?1:0)-(e.isBrandNew?1:0));break;default:s=s.sort((e,s)=>(s.rating||0)*(s.reviewsCount||0)-(e.rating||0)*(e.reviewsCount||0))}console.log("Final filtered products:",s),y([...s])};(0,r.useEffect)(()=>{console.log("useEffect triggered for applying filters"),console.log("Products length:",e.length),console.log("Selected categories:",q),console.log("Selected countries:",E),console.log("Price range:",I),console.log("Sort by:",Q),e.length>0?(console.log("Applying filters..."),es()):console.log("No products to filter")},[q,E,I,Q,e]),(0,r.useEffect)(()=>{console.log("Filtered products updated:",t),console.log("Filtered products length:",t?.length)},[t]);let et=()=>{U([]),F([]),M([0,15e3]),Z("discount")};return(0,l.jsxs)("div",{className:"min-h-screen bg-cream-50",children:[l.jsx(a.default,{}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("h1",{className:"font-display text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:["Распродажа",q.length>0&&(0,l.jsxs)("span",{className:"text-xl font-normal text-gray-600 ml-4",children:["(",X.find(e=>q.includes(e.id))?.name,")"]})]}),(0,l.jsxs)("p",{className:"text-lg text-gray-600",children:["Найдено товаров: ",t&&Array.isArray(t)?t.length:0,0===q.length&&l.jsx("span",{className:"ml-2",children:"(показаны все категории)"})]})]}),(0,l.jsxs)("div",{className:"flex gap-8",children:[l.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:l.jsx(n.z,{onClick:()=>T(!B),className:"rounded-full shadow-lg",size:"lg",children:l.jsx(g.Z,{className:"w-5 h-5"})})}),(0,l.jsxs)("div",{className:`${B?"fixed inset-0 z-40 bg-white p-6 lg:relative lg:inset-auto lg:z-auto lg:bg-transparent lg:p-0":"hidden"} lg:block w-full lg:w-80 lg:flex-shrink-0`,children:[B&&(0,l.jsxs)("div",{className:"lg:hidden flex justify-between items-center mb-6",children:[l.jsx("h2",{className:"font-heading text-xl font-bold",children:"Фильтры"}),l.jsx(n.z,{onClick:()=>T(!1),variant:"ghost",size:"icon",children:l.jsx(x.Z,{className:"w-5 h-5"})})]}),l.jsx("div",{className:"lg:bg-white lg:rounded-2xl lg:p-6 lg:shadow-sm",children:l.jsx(()=>(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("div",{children:[l.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Цена"}),(0,l.jsxs)("div",{className:"space-y-4",children:[l.jsx(c.i,{value:I,onValueChange:M,max:15e3,step:100,className:"w-full"}),(0,l.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[l.jsx("span",{children:Y(I[0])}),l.jsx("span",{children:Y(I[1])})]})]})]}),(0,l.jsxs)("div",{children:[l.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Категории"}),l.jsx("div",{className:"space-y-3",children:X.map(e=>{let s=A.find(s=>s._id===e.id);return(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[l.jsx(o.X,{id:e.id,checked:q.includes(e.id),onCheckedChange:s=>L(e.id,s)}),(0,l.jsxs)("label",{htmlFor:e.id,className:"flex-1 text-sm cursor-pointer hover:text-primary transition-colors",onClick:e=>{e.preventDefault(),s&&W(s.slug)},children:[e.name,(0,l.jsxs)("span",{className:"text-gray-400 ml-1",children:["(",e.count,")"]})]})]},e.id)})})]}),(0,l.jsxs)("div",{children:[l.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Страна производитель"}),l.jsx("div",{className:"space-y-3",children:V.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[l.jsx(o.X,{id:e.id||"",checked:!!e.id&&E.includes(e.id),onCheckedChange:s=>e.id&&H(e.id,s)}),(0,l.jsxs)("label",{htmlFor:e.id||"",className:"flex-1 text-sm cursor-pointer",children:[e.name,(0,l.jsxs)("span",{className:"text-gray-400 ml-1",children:["(",e.count,")"]})]})]},e.id))})]}),l.jsx(n.z,{onClick:et,variant:"outline",className:"w-full",children:"Очистить фильтры"})]}),{})})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[l.jsx("span",{className:"text-gray-600",children:"Сортировать:"}),(0,l.jsxs)(d.Ph,{value:Q,onValueChange:Z,children:[l.jsx(d.i4,{className:"w-48",children:l.jsx(d.ki,{})}),(0,l.jsxs)(d.Bw,{children:[l.jsx(d.Ql,{value:"discount",children:"По размеру скидки"}),l.jsx(d.Ql,{value:"price-low",children:"Цена: по возрастанию"}),l.jsx(d.Ql,{value:"price-high",children:"Цена: по убыванию"}),l.jsx(d.Ql,{value:"rating",children:"По рейтингу"}),l.jsx(d.Ql,{value:"new",children:"Сначала новинки"}),l.jsx(d.Ql,{value:"popularity",children:"По популярности"})]})]})]}),l.jsx(n.z,{onClick:es,className:"lg:hidden",children:"Применить фильтры"})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:$?l.jsx(b.mA,{count:6}):S?l.jsx("div",{className:"col-span-full",children:l.jsx(w.F7,{onRetry:()=>window.location.reload()})}):t&&Array.isArray(t)&&t.length>0?t.map((e,s)=>l.jsx(N.SlideIn,{delay:50*s,children:(0,l.jsxs)("div",{className:"group bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 overflow-hidden",children:[(0,l.jsxs)("div",{className:"relative overflow-hidden bg-gray-100 h-64",children:[l.jsx(j(),{href:`/product/${e.slug}`,children:l.jsx("img",{src:e.mainImage||"/placeholder-product.jpg",alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),(0,l.jsxs)("div",{className:"absolute top-4 left-4 flex flex-col space-y-2",children:[e.isBrandNew&&l.jsx("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:"NEW"}),e.isOnSale&&e.originalPrice&&(0,l.jsxs)("span",{className:"bg-accent text-white text-xs px-2 py-1 rounded-full font-semibold",children:["-",ee(e.originalPrice,e.price),"%"]})]}),(0,l.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transform translate-x-4 group-hover:translate-x-0 transition-all duration-300",children:[l.jsx(n.z,{size:"icon",variant:"secondary",className:`w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white shadow-md ${K(e._id)?"text-red-500 hover:text-red-600":"text-gray-600 hover:text-red-500"}`,onClick:s=>J(e,s),children:l.jsx(u.Z,{className:`w-4 h-4 ${K(e._id)?"fill-current":""}`})}),l.jsx(k.i,{product:e,children:l.jsx(n.z,{size:"icon",variant:"secondary",className:"w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white shadow-md text-gray-600 hover:text-blue-500",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:l.jsx(h.Z,{className:"w-4 h-4"})})})]}),l.jsx("div",{className:"absolute bottom-4 left-4",children:l.jsx("span",{className:"bg-white/90 backdrop-blur-sm text-gray-700 text-xs px-3 py-1 rounded-full font-medium",children:e.country})})]}),(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:e.categoryId?e.categoryId.name:e.category?e.category.name:""}),(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[l.jsx(p.Z,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),l.jsx("span",{className:"text-sm text-gray-600",children:e.rating||0}),(0,l.jsxs)("span",{className:"text-sm text-gray-400",children:["(",e.reviewsCount||0,")"]})]})]}),l.jsx(j(),{href:`/product/${e.slug}`,children:l.jsx("h3",{className:"font-heading text-lg font-bold text-gray-900 mb-3 group-hover:text-primary transition-colors",children:e.name})}),l.jsx("div",{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[l.jsx("span",{className:"text-xl font-bold text-primary",children:Y(e.price)}),e.originalPrice&&l.jsx("span",{className:"text-sm text-gray-500 line-through",children:Y(e.originalPrice)})]})})]})]})},e._id)):(0,l.jsxs)("div",{className:"col-span-full text-center py-12",children:[l.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Товары со скидкой не найдены"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Попробуйте изменить параметры фильтрации или обновить страницу"})]})})]})]})]}),l.jsx(P.Q,{isOpen:R,onClose:()=>D(!1),message:"Для добавления товара в избранное необходимо войти в систему"}),l.jsx(i.default,{})]})}},7862:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>a,default:()=>o});var l=t(7536);let r=(0,l.createProxy)(String.raw`/Users/mikhailkolotushin/KolTech/projects/dvb/client/app/sale/page.tsx`),{__esModule:a,$$typeof:i}=r,n=r.default,o=n}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),l=s.X(0,[6498,7001,7240,5298,1913,1788,1590,4796,6037,1086,7372,6606,997,8632],()=>t(9986));module.exports=l})();