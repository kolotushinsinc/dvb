"use strict";exports.id=1747,exports.ids=[1747],exports.modules={4653:(e,l,a)=>{a.d(l,{V:()=>u});var s=a(80),t=a(9885),i=a(8384),r=a(3780),c=a(589),n=a(8971),o=a(2029),d=a(6206);let u=({categories:e,products:l,onFilterChange:a,initialCategory:u})=>{let[b,v]=(0,t.useState)(!1),[y,g]=(0,t.useState)({priceRange:[0,15e3],selectedCategories:u?[u]:[],selectedFilters:{},selectedCountries:[],sortBy:"popularity"});(0,t.useEffect)(()=>{u&&!y.selectedCategories.includes(u)&&g(e=>({...e,selectedCategories:[u]}))},[u]);let p=1===y.selectedCategories.length?e.find(e=>e._id===y.selectedCategories[0]):null,h=(e=>{switch(e){case"GLASSES":return[{key:"gender",label:"Пол",type:"CHECKBOX",options:[{value:"MALE",label:"Мужской"},{value:"FEMALE",label:"Женский"},{value:"UNISEX",label:"Унисекс"}],isActive:!0},{key:"frameMaterial",label:"Материал оправы",type:"CHECKBOX",options:[{value:"Ацетат",label:"Ацетат"},{value:"Алюминий",label:"Алюминий"},{value:"Углеродное волокно",label:"Углеродное волокно"},{value:"Нейлон",label:"Нейлон"},{value:"Пластмасса",label:"Пластмасса"},{value:"Смола",label:"Смола"},{value:"Резина",label:"Резина"},{value:"Нержавеющая сталь",label:"Нержавеющая сталь"},{value:"Титан",label:"Титан"},{value:"Дерево",label:"Дерево"}],isActive:!0},{key:"frameStyle",label:"Стиль обода оправы",type:"CHECKBOX",options:[{value:"FULL_RIM",label:"Полный обод"},{value:"RIMLESS",label:"Безободковый"},{value:"SEMI_RIMLESS",label:"Полубезободковый"}],isActive:!0},{key:"lensType",label:"Тип объектива",type:"CHECKBOX",options:[{value:"Classic",label:"Classic"},{value:"Flash",label:"Flash"},{value:"Gradient",label:"Gradient"},{value:"Mirrored",label:"Mirrored"},{value:"Polarized",label:"Polarized"},{value:"Standard",label:"Standard"}],isActive:!0},{key:"availability",label:"Наличие",type:"CHECKBOX",options:[{value:"IN_STOCK",label:"Товар в наличии"},{value:"PRE_ORDER",label:"Предзаказ"}],isActive:!0}];case"SHOES":return[{key:"gender",label:"Пол",type:"CHECKBOX",options:[{value:"MALE",label:"Мужская"},{value:"FEMALE",label:"Женская"},{value:"UNISEX",label:"Унисекс"}],isActive:!0},{key:"shoeSizeSystem",label:"Система размеров",type:"SELECT",options:[{value:"RUS",label:"Российский (RUS)"},{value:"EU",label:"Европейский (EU)"},{value:"US",label:"Американский (US)"},{value:"CM",label:"См (Длина стельки)"}],isActive:!0},{key:"upperMaterial",label:"Материал верха",type:"CHECKBOX",options:[{value:"Натуральная кожа",label:"Натуральная кожа"},{value:"Замша",label:"Замша"},{value:"Нубук",label:"Нубук"},{value:"Текстиль/Холст",label:"Текстиль/Холст"},{value:"Сетка (Мэш)",label:"Сетка (Мэш)"},{value:"Искусственная кожа",label:"Искусственная кожа"},{value:"Резина",label:"Резина"},{value:"Комбинированные материалы",label:"Комбинированные материалы"}],isActive:!0},{key:"soleType",label:"Тип подошвы",type:"CHECKBOX",options:[{value:"Плоская",label:"Плоская (для скейтбординга)"},{value:"Амортизирующая",label:"Амортизирующая (для бега)"},{value:"Резиновая",label:"Резиновая (для трейла)"},{value:"Каучуковая",label:"Каучуковая"},{value:"EVA",label:"EVA (легкая)"}],isActive:!0},{key:"brandTechnology",label:"Технологии брендов",type:"CHECKBOX",options:[{value:"Air Max",label:"Nike: Air Max"},{value:"Air Force",label:"Nike: Air Force"},{value:"Dunk",label:"Nike: Dunk"},{value:"Jordan",label:"Nike: Jordan"},{value:"ZoomX",label:"Nike: ZoomX"},{value:"React",label:"Nike: React"},{value:"Flyknit",label:"Nike: Flyknit"},{value:"Boost",label:"Adidas: Boost"},{value:"Ultraboost",label:"Adidas: Ultraboost"},{value:"NMD",label:"Adidas: NMD"},{value:"Yeezy",label:"Adidas: Yeezy"},{value:"4D",label:"Adidas: 4D"},{value:"Primeknit",label:"Adidas: Primeknit"},{value:"Fresh Foam",label:"New Balance: Fresh Foam"},{value:"FuelCell",label:"New Balance: FuelCell"},{value:"GEL",label:"Asics: GEL"},{value:"GORE-TEX",label:"GORE-TEX"},{value:"VIBRAM",label:"VIBRAM"}],isActive:!0},{key:"availability",label:"Наличие",type:"CHECKBOX",options:[{value:"IN_STOCK",label:"Товар в наличии"},{value:"PRE_ORDER",label:"Предзаказ"}],isActive:!0}];case"CLOTHING":return[{key:"gender",label:"Пол",type:"CHECKBOX",options:[{value:"MALE",label:"Мужское"},{value:"FEMALE",label:"Женское"},{value:"UNISEX",label:"Унисекс"}],isActive:!0},{key:"clothingSizeSystem",label:"Система размеров",type:"SELECT",options:[{value:"INT",label:"Международные"},{value:"RUS",label:"Российские"},{value:"US",label:"Американские"}],isActive:!0},{key:"fabric",label:"Материал",type:"CHECKBOX",options:[{value:"Хлопок",label:"Хлопок"},{value:"Полиэстер",label:"Полиэстер"},{value:"Нейлон",label:"Нейлон"},{value:"Шерсть",label:"Шерсть"},{value:"Кашемир",label:"Кашемир"},{value:"Деним",label:"Деним"},{value:"Кожа",label:"Кожа"},{value:"Замша",label:"Замша"},{value:"Флис",label:"Флис"},{value:"Вискоза",label:"Вискоза"},{value:"Лен",label:"Лен"}],isActive:!0},{key:"style",label:"Стиль",type:"CHECKBOX",options:[{value:"Повседневный",label:"Повседневный (Кэжуал)"},{value:"Спортивный",label:"Спортивный (Эйджис)"},{value:"Уличный стиль",label:"Уличный стиль (Стритвир)"},{value:"Официальный",label:"Официальный (Деловой)"},{value:"Винтаж",label:"Винтаж"},{value:"Минимализм",label:"Минимализм"},{value:"Хай-фэшн",label:"Хай-фэшн (Дизайнерский)"}],isActive:!0},{key:"pattern",label:"Рисунок/Принт",type:"CHECKBOX",options:[{value:"Однотонный",label:"Однотонный"},{value:"С логотипом",label:"С логотипом"},{value:"Графический принт",label:"Графический принт"},{value:"Полоска",label:"Полоска"},{value:"Камуфляж",label:"Камуфляж"},{value:"Цветочный принт",label:"Цветочный принт"},{value:"Надписи",label:"Надписи"},{value:"Без принта",label:"Без принта"}],isActive:!0},{key:"availability",label:"Наличие",type:"CHECKBOX",options:[{value:"IN_STOCK",label:"Товар в наличии"},{value:"PRE_ORDER",label:"Предзаказ"}],isActive:!0}];case"ACCESSORIES":return[{key:"gender",label:"Пол",type:"CHECKBOX",options:[{value:"MALE",label:"Мужской"},{value:"FEMALE",label:"Женский"},{value:"UNISEX",label:"Унисекс"}],isActive:!0},{key:"material",label:"Материал",type:"CHECKBOX",options:[{value:"Кожа",label:"Кожа"},{value:"Текстиль",label:"Текстиль"},{value:"Металл",label:"Металл"},{value:"Пластик",label:"Пластик"},{value:"Дерево",label:"Дерево"}],isActive:!0},{key:"style",label:"Стиль",type:"CHECKBOX",options:[{value:"Повседневный",label:"Повседневный"},{value:"Спортивный",label:"Спортивный"},{value:"Официальный",label:"Официальный"},{value:"Винтаж",label:"Винтаж"}],isActive:!0},{key:"availability",label:"Наличие",type:"CHECKBOX",options:[{value:"IN_STOCK",label:"Товар в наличии"},{value:"PRE_ORDER",label:"Предзаказ"}],isActive:!0}];default:return[]}})(p?.categoryType),m=Array.from(new Set(l.map(e=>e.country).filter(Boolean))).map(e=>({id:e,name:e,count:l.filter(l=>l.country===e).length})),x=e.map(e=>({id:e._id,slug:e.slug,name:e.name,count:l.filter(l=>l.categoryId&&l.categoryId._id===e._id||l.category&&l.category._id===e._id).length}));(0,t.useEffect)(()=>{C()},[y,l]);let C=()=>{let e=l.filter(e=>{let l=e.price>=y.priceRange[0]&&e.price<=y.priceRange[1],a=!0;y.selectedCategories.length>0&&(a=e.categoryId&&e.categoryId._id?y.selectedCategories.includes(e.categoryId._id):!!e.category&&!!e.category._id&&y.selectedCategories.includes(e.category._id));let s=0===y.selectedCountries.length||e.country&&y.selectedCountries.includes(e.country),t=!0;if(Object.keys(y.selectedFilters).length>0&&e.attributes){for(let[l,a]of Object.entries(y.selectedFilters))if(a.length>0){let s=e.attributes[l];Array.isArray(s)?t=t&&a.some(e=>s.includes(e)):"string"==typeof s?t=t&&a.includes(s):"number"==typeof s&&(t=t&&a.includes(s.toString()))}}return l&&a&&s&&t});switch(y.sortBy){case"price-low":e=e.sort((e,l)=>e.price-l.price);break;case"price-high":e=e.sort((e,l)=>l.price-e.price);break;case"rating":e=e.sort((e,l)=>(l.rating||0)-(e.rating||0));break;case"new":e=e.sort((e,l)=>(l.isBrandNew?1:0)-(e.isBrandNew?1:0));break;default:e=e.sort((e,l)=>(l.rating||0)*(l.reviewsCount||0)-(e.rating||0)*(e.reviewsCount||0))}a(y)},f=(e,l)=>{g(a=>({...a,selectedCategories:l?[...a.selectedCategories,e]:a.selectedCategories.filter(l=>l!==e)}))},E=(e,l)=>{g(a=>({...a,selectedCountries:l?[...a.selectedCountries,e]:a.selectedCountries.filter(l=>l!==e)}))},A=(e,l,a)=>{g(s=>{let t=s.selectedFilters[e]||[],i=a?[...t,l]:t.filter(e=>e!==l);return{...s,selectedFilters:{...s.selectedFilters,[e]:i}}})},k=()=>{g({priceRange:[0,15e3],selectedCategories:u?[u]:[],selectedFilters:{},selectedCountries:[],sortBy:"popularity"})},j=e=>new Intl.NumberFormat("ru-RU").format(e)+" ₽",N=e=>{let l=y.selectedFilters[e.key]||[];switch(e.type){case"SELECT":return(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:e.label}),(0,s.jsxs)(n.Ph,{value:l[0]||"",onValueChange:l=>A(e.key,l,!!l),children:[s.jsx(n.i4,{children:s.jsx(n.ki,{placeholder:`Выберите ${e.label.toLowerCase()}`})}),s.jsx(n.Bw,{children:e.options?.map(e=>s.jsx(n.Ql,{value:e.value,children:e.label},e.value))})]})]},e.key);case"MULTI_SELECT":case"CHECKBOX":return(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:e.label}),s.jsx("div",{className:"space-y-3",children:e.options?.map(a=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(r.X,{id:`${e.key}-${a.value}`,checked:l.includes(a.value),onCheckedChange:l=>A(e.key,a.value,l)}),s.jsxs("label",{htmlFor:`${e.key}-${a.value}`,className:"flex-1 text-sm cursor-pointer",children:[a.label,void 0!==a.count&&s.jsxs("span",{className:"text-gray-400 ml-1",children:["(",a.count,")"]})]})]},a.value))})]},e.key);case"RANGE":return(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:e.label}),s.jsx(c.i,{value:[l[0]?parseInt(l[0]):e.min||0],onValueChange:l=>A(e.key,l[0].toString(),!0),max:e.max||100,step:1,className:"w-full"}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,s.jsxs)("span",{children:[e.min||0,e.unit]}),(0,s.jsxs)("span",{children:[l[0]||e.min||0,e.unit]}),(0,s.jsxs)("span",{children:[e.max||100,e.unit]})]})]},e.key);case"COLOR":return(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:e.label}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.options?.map(a=>s.jsx("button",{className:`w-8 h-8 rounded-full border-2 ${l.includes(a.value)?"border-primary scale-110":"border-gray-300 hover:border-gray-400"}`,style:{backgroundColor:a.value},onClick:()=>A(e.key,a.value,!l.includes(a.value)),title:a.label},a.value))})]},e.key);default:return null}};return(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:s.jsx(i.z,{onClick:()=>v(!b),className:"rounded-full shadow-lg",size:"lg",children:s.jsx(o.Z,{className:"w-5 h-5"})})}),(0,s.jsxs)("div",{className:`${b?"fixed inset-0 z-40 bg-white p-6 lg:relative lg:inset-auto lg:z-auto lg:bg-transparent lg:p-0":"hidden"} lg:block w-full lg:w-80 lg:flex-shrink-0`,children:[b&&(0,s.jsxs)("div",{className:"lg:hidden flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"font-heading text-xl font-bold",children:"Фильтры"}),s.jsx(i.z,{onClick:()=>v(!1),variant:"ghost",size:"icon",children:s.jsx(d.Z,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"lg:bg-white lg:rounded-2xl lg:p-6 lg:shadow-sm",children:s.jsx(()=>(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Цена"}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx(c.i,{value:y.priceRange,onValueChange:e=>g(l=>({...l,priceRange:e})),max:15e3,step:100,className:"w-full"}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[s.jsx("span",{children:j(y.priceRange[0])}),s.jsx("span",{children:j(y.priceRange[1])})]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Категории"}),s.jsx("div",{className:"space-y-3",children:x.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx(r.X,{id:e.id,checked:y.selectedCategories.includes(e.id),onCheckedChange:l=>f(e.id,l)}),(0,s.jsxs)("label",{htmlFor:e.id,className:"flex-1 text-sm cursor-pointer hover:text-primary transition-colors",children:[e.name,(0,s.jsxs)("span",{className:"text-gray-400 ml-1",children:["(",e.count,")"]})]})]},e.id))})]}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-heading text-lg font-semibold mb-4",children:"Страна производитель"}),s.jsx("div",{className:"space-y-3",children:m.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx(r.X,{id:e.id||"",checked:!!e.id&&y.selectedCountries.includes(e.id),onCheckedChange:l=>e.id&&E(e.id,l)}),(0,s.jsxs)("label",{htmlFor:e.id||"",className:"flex-1 text-sm cursor-pointer",children:[e.name,(0,s.jsxs)("span",{className:"text-gray-400 ml-1",children:["(",e.count,")"]})]})]},e.id))})]}),h.map(N),s.jsx(i.z,{onClick:k,variant:"outline",className:"w-full",children:"Очистить фильтры"})]}),{})})]})]})}},3727:(e,l,a)=>{a.d(l,{M:()=>n,r:()=>c});var s=a(9885),t=a(7936);let i=null,r=!1,c=(e={})=>{let[l,a]=(0,s.useState)(i||[]),[c,n]=(0,s.useState)(!i),[o,d]=(0,s.useState)(null),u=(0,s.useCallback)(async()=>{if(i&&!e.category&&!e.search){a(i),n(!1);return}if(!r){r=!0;try{n(!0),d(null);let l=await t.h.products.getAll(e),s=[];console.log("\uD83D\uDD0D Processing response format:",{hasData:!!l?.data,dataIsArray:Array.isArray(l?.data),hasSuccess:l?.success,hasProducts:!!l?.products,productsIsArray:Array.isArray(l?.products),isDirectArray:Array.isArray(l)}),l&&l.data&&Array.isArray(l.data)?(s=l.data,console.log("✅ Using direct data format, count:",s.length)):l&&!0===l.success&&l.data&&l.data.products&&Array.isArray(l.data.products)?(s=l.data.products,console.log("✅ Using nested data.products format, count:",s.length)):l&&l.products&&Array.isArray(l.products)?(s=l.products,console.log("✅ Using direct products format, count:",s.length)):l&&l.data&&Array.isArray(l.data)?(s=l.data,console.log("✅ Using direct data array format, count:",s.length)):Array.isArray(l)&&(s=l,console.log("✅ Using direct array format, count:",s.length)),e.category||e.search||(i=s),0===s.length&&console.warn(`🚨 No products found`),a(s)}catch(e){d("Не удалось загрузить товары"),console.error("Load error:",e)}finally{n(!1),r=!1}}},[e.category,e.search]);(0,s.useEffect)(()=>{console.log("\uD83D\uDD27 PRODUCTS HOOK - Component mounted or options changed, calling loadProducts"),u()},[u]);let b=(0,s.useCallback)(()=>{e.category||e.search||(i=null),u()},[u]);return{products:l,loading:c,error:o,refreshProducts:b}},n=(e,l,a)=>{let t=(0,s.useMemo)(()=>(console.log("\uD83D\uDD0D FILTER DEBUG - Starting filter:",{totalProducts:e.length,selectedCategories:a.selectedCategories,priceRange:a.priceRange}),e.filter(e=>{let l=e.price>=a.priceRange[0]&&e.price<=a.priceRange[1],s=!0;a.selectedCategories.length>0&&(s=e.categoryId&&e.categoryId._id?a.selectedCategories.includes(e.categoryId._id):!!e.category&&!!e.category._id&&a.selectedCategories.includes(e.category._id));let t=0===a.selectedCountries.length||e.country&&a.selectedCountries.includes(e.country),i=!0;if(Object.keys(a.selectedFilters).length>0&&e.attributes){for(let[l,s]of Object.entries(a.selectedFilters))if(s.length>0){let a=e.attributes[l];Array.isArray(a)?i=i&&s.some(e=>a.includes(e)):"string"==typeof a?i=i&&s.includes(a):"number"==typeof a&&(i=i&&s.includes(a.toString()))}}return l&&s&&t&&i})),[e,a]);return t}}};