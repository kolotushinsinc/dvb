"use strict";exports.id=7372,exports.ids=[7372],exports.modules={14:(e,t,a)=>{a.d(t,{c:()=>l});var s=a(80),r=a(6037);let l=({colors:e,selectedColor:t,onColorChange:a})=>(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Цвет"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(e)).map(e=>{let l=(0,r.OA)(e),i=t===e;return s.jsx("button",{className:`w-8 h-8 rounded-full border-2 transition-all duration-200 hover:scale-110 ${i?"border-gray-800 ring-2 ring-offset-2 ring-gray-300":"border-gray-300 hover:border-gray-400"}`,style:{backgroundColor:l?.value||"#CCCCCC",borderColor:"Белый"===e?"#E5E7EB":void 0},onClick:()=>a(e),title:e,"aria-label":`Выбрать цвет ${e}`},e)})}),t&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Выбран: ",t]})]})},7372:(e,t,a)=>{a.d(t,{i:()=>O});var s=a(80),r=a(9885),l=a(1440),i=a.n(l),n=a(1910),o=a(1922),c=a(5894),d=a(7371),m=a(1839),h=a(8384),u=a(4796),g=a(14),x=a(5479),f=a(442),p=a(8931);let v=0,j=new Map,y=e=>{if(j.has(e))return;let t=setTimeout(()=>{j.delete(e),S({type:"REMOVE_TOAST",toastId:e})},1e6);j.set(e,t)},b=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?y(a):e.toasts.forEach(e=>{y(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},N=[],w={toasts:[]};function S(e){w=b(w,e),N.forEach(e=>{e(w)})}function C({...e}){let t=(v=(v+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>S({type:"DISMISS_TOAST",toastId:t});return S({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>S({type:"UPDATE_TOAST",toast:{...e,id:t}})}}var A=a(3161),T=a(1086),E=a(7936);function O({product:e,className:t,children:a}){let[l,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(null),[b,O]=(0,r.useState)(null),[_,k]=(0,r.useState)(1),[I,z]=(0,r.useState)(!1),[D,F]=(0,r.useState)(0),[M,U]=(0,r.useState)(null),[$,Z]=(0,r.useState)(!1),{addItem:P}=(0,f.j)(),{isFavorite:R,toggleFavorite:B}=(0,p.r)(),{toast:L}=function(){let[e,t]=r.useState(w);return r.useEffect(()=>(N.push(t),()=>{let e=N.indexOf(t);e>-1&&N.splice(e,1)}),[e]),{...e,toast:C,dismiss:e=>S({type:"DISMISS_TOAST",toastId:e})}}();(0,r.useEffect)(()=>{if(e.variants&&Array.isArray(e.variants)&&e.variants.length>0){let t=e.variants.filter(e=>"COLOR"===e.type),a=e.variants.filter(e=>"SIZE"===e.type);t.length>0&&y(t[0].value),a.length>0&&O(a[0].value)}},[e]),(0,r.useEffect)(()=>{let t=async()=>{if(l&&e._id)try{Z(!0),console.log("Fetching complete product data for:",e._id);let t=await E.h.products.getById(e._id);console.log("Complete product data:",t);let a=t;t&&!0===t.success&&t.data&&t.data.product&&(a=t.data.product,console.log("Using nested data.product format")),U(a),F(0)}catch(t){console.error("Error fetching complete product data:",t),U(e)}finally{Z(!1)}};t()},[l,e._id]);let V=async()=>{try{await B(G._id),R(G._id)?L({title:"Товар удален из избранного",description:`${G.name} удален из избранного`}):L({title:"Товар добавлен в избранное",description:`${G.name} добавлен в избранное`})}catch(e){L({title:"Ошибка",description:"Не удалось добавить товар в избранное",variant:"destructive"})}},q=async e=>{e.preventDefault(),e.stopPropagation(),await V()},G=M||e,Q=Array.from(new Set(G.variants&&Array.isArray(G.variants)?G.variants.filter(e=>"COLOR"===e.type).map(e=>e.value):[])),X=Array.from(new Set(G.variants&&Array.isArray(G.variants)?G.variants.filter(e=>"SIZE"===e.type).map(e=>e.value):[]));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(m.Vq,{open:l,onOpenChange:e=>{e||v(!1)},children:[s.jsx(m.hg,{asChild:!0,onClick:e=>{e.preventDefault(),e.stopPropagation(),v(!0)},children:a}),s.jsx(m.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg",children:$?s.jsx("div",{className:"flex items-center justify-center h-full bg-gray-100",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):G.images&&G.images.length>0?(0,s.jsxs)(s.Fragment,{children:[s.jsx(T.w,{src:G.images[D].url,thumbnailSrc:G.images[D].thumbnailUrl,alt:G.images[D].alt||G.name,className:"w-full h-full object-cover"}),G.images.length>1&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(h.z,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white rounded-full transition-colors z-10",onClick:()=>{G.images&&!(G.images.length<=1)&&F(e=>(e-1+G.images.length)%G.images.length)},children:s.jsx(n.Z,{className:"w-4 h-4"})}),s.jsx(h.z,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white rounded-full transition-colors z-10",onClick:()=>{G.images&&!(G.images.length<=1)&&F(e=>(e+1)%G.images.length)},children:s.jsx(o.Z,{className:"w-4 h-4"})})]})]}):G.mainImage?s.jsx(T.w,{src:G.mainImage,alt:G.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"flex items-center justify-center h-full bg-gray-100",children:s.jsx("span",{className:"text-gray-500",children:"Нет изображения"})})}),!$&&G.images&&G.images.length>1&&s.jsx("div",{className:"flex space-x-2 overflow-x-auto py-2",children:G.images.map((e,t)=>s.jsx("button",{className:(0,A.cn)("relative w-16 h-16 overflow-hidden rounded border",D===t?"border-primary":"border-gray-200"),onClick:()=>F(t),children:s.jsx(T.w,{src:e.url,thumbnailSrc:e.thumbnailUrl,alt:e.alt||`${G.name} ${t+1}`,className:"w-full h-full object-cover"})},t))})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:G.name}),s.jsx("p",{className:"text-gray-600",children:G.description})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[G.category&&s.jsx(u.C,{variant:"secondary",children:G.category.name}),G.isBrandNew&&s.jsx(u.C,{variant:"default",children:"Новинка"}),G.isOnSale&&s.jsx(u.C,{variant:"destructive",children:"Распродажа"})]}),(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[new Intl.NumberFormat("ru-RU").format(G.price)," ₽"]}),Q.length>0&&(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-sm font-medium mb-2",children:"Цвет:"}),s.jsx(g.c,{colors:Q,selectedColor:j||void 0,onColorChange:y})]}),X.length>0&&(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-sm font-medium mb-2",children:"Размер:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:X.map(e=>s.jsx("button",{className:(0,A.cn)("px-3 py-1 border rounded-md text-sm",b===e?"border-primary bg-primary text-primary-foreground":"border-gray-300 hover:border-gray-400"),onClick:()=>O(e),children:e},e))})]}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-sm font-medium mb-2",children:"Количество:"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx(h.z,{variant:"outline",size:"icon",onClick:()=>k(Math.max(1,_-1)),disabled:_<=1,children:"-"}),s.jsx("span",{className:"w-8 text-center",children:_}),s.jsx(h.z,{variant:"outline",size:"icon",onClick:()=>k(Math.min(G.stock,_+1)),disabled:_>=G.stock,children:"+"})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["В наличии: ",G.stock," шт."]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[(0,s.jsxs)(h.z,{onClick:()=>{if(!j&&!b){L({title:"Ошибка",description:"Пожалуйста, выберите цвет или размер",variant:"destructive"});return}if(G.stock<_){L({title:"Ошибка",description:"Недостаточно товара на складе",variant:"destructive"});return}P(G,_,b||void 0,j||void 0),L({title:"Товар добавлен в корзину",description:`${G.name} добавлен в корзину`}),v(!1)},disabled:0===G.stock,className:"flex-1",children:[s.jsx(c.Z,{className:"mr-2 h-4 w-4"}),"Добавить в корзину"]}),(0,s.jsxs)(h.z,{variant:"outline",onClick:q,className:"flex-1",children:[s.jsx(d.Z,{className:(0,A.cn)("mr-2 h-4 w-4",R(G._id)?"fill-red-500 text-red-500":"")}),R(G._id)?"Удалить из избранного":"Добавить в избранное"]})]}),s.jsx("div",{className:"pt-2",children:s.jsx(h.z,{asChild:!0,variant:"ghost",className:"w-full",children:s.jsx(i(),{href:`/product/${G.slug}`,children:"Перейти на страницу товара"})})})]})]})})]}),s.jsx(x.Q,{isOpen:I,onClose:()=>z(!1),message:"Для добавления товара в избранное необходимо войти в систему"})]})}},8931:(e,t,a)=>{a.d(t,{r:()=>l});var s=a(9885),r=a(7936);let l=()=>{let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[i,n]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=async()=>{try{let e=await r.h.auth.getProfile().catch(()=>null);if(n(!!e),e){l(!0);let e=await r.h.favorites.get();t(e.map(e=>e._id))}}catch(e){console.error("Failed to check auth or load favorites:",e)}finally{l(!1)}};e()},[]);let d=t=>e.includes(t),m=async e=>{if(console.log("toggleFavorite called, isLoggedIn:",i),!i){console.log("User not logged in, showing auth modal"),c(!0);return}try{console.log("User is logged in, toggling favorite"),d(e)?(await r.h.favorites.remove(e),t(t=>t.filter(t=>t!==e))):(await r.h.favorites.add(e),t(t=>[...t,e]))}catch(e){throw console.error("Failed to toggle favorite:",e),e}};return{favorites:e,loading:a,isLoggedIn:i,showAuthModal:o,setShowAuthModal:c,isFavorite:d,toggleFavorite:m}}}};