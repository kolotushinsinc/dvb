"use strict";exports.id=7372,exports.ids=[7372],exports.modules={14:(e,a,s)=>{s.d(a,{c:()=>l});var r=s(80),t=s(6037);let l=({colors:e,selectedColor:a,onColorChange:s,compact:l=!1})=>(0,r.jsxs)("div",{children:[!l&&r.jsx("h3",{className:"font-medium mb-2",children:"Цвет"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(e)).map(e=>{let o=(0,t.OA)(e),i=a===e;return r.jsx("button",{className:`${l?"w-7 h-7":"w-8 h-8"} rounded-full border-2 transition-all duration-200 hover:scale-110 ${i?"border-primary-500 ring-2 ring-offset-2 ring-primary-200":"border-secondary-200 hover:border-primary-300"}`,style:{backgroundColor:o?.value||"#CCCCCC",borderColor:"Белый"===e?"#E5E7EB":void 0},onClick:()=>s(e),title:e,"aria-label":`Выбрать цвет ${e}`},e)})}),a&&!l&&(0,r.jsxs)("p",{className:"text-sm text-charcoal-600 mt-2",children:["Выбран: ",a]})]})},7372:(e,a,s)=>{s.d(a,{i:()=>I});var r=s(80),t=s(9885),l=s(1440),o=s.n(l),i=s(1910),n=s(1922),c=s(7932),d=s(8375),m=s(2385),h=s(5894),x=s(7371),p=s(1839),g=s(8384),u=s(14),f=s(5479),v=s(442),b=s(8931);let y=0,w=new Map,j=e=>{if(w.has(e))return;let a=setTimeout(()=>{w.delete(e),k({type:"REMOVE_TOAST",toastId:e})},1e6);w.set(e,a)},N=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=a;return s?j(s):e.toasts.forEach(e=>{j(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},S=[],C={toasts:[]};function k(e){C=N(C,e),S.forEach(e=>{e(C)})}function A({...e}){let a=(y=(y+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>k({type:"DISMISS_TOAST",toastId:a});return k({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>k({type:"UPDATE_TOAST",toast:{...e,id:a}})}}var O=s(3161),T=s(1086),E=s(7936);function I({product:e,className:a,children:s}){let[l,y]=(0,t.useState)(!1),[w,j]=(0,t.useState)(null),[N,I]=(0,t.useState)(null),[_,z]=(0,t.useState)(1),[$,D]=(0,t.useState)(!1),[F,Z]=(0,t.useState)(0),[M,U]=(0,t.useState)(null),[P,R]=(0,t.useState)(!1),{addItem:B}=(0,v.j)(),{isFavorite:L,toggleFavorite:V}=(0,b.r)(),{toast:q}=function(){let[e,a]=t.useState(C);return t.useEffect(()=>(S.push(a),()=>{let e=S.indexOf(a);e>-1&&S.splice(e,1)}),[e]),{...e,toast:A,dismiss:e=>k({type:"DISMISS_TOAST",toastId:e})}}();(0,t.useEffect)(()=>{if(e.variants&&Array.isArray(e.variants)&&e.variants.length>0){let a=e.variants.filter(e=>"COLOR"===e.type),s=e.variants.filter(e=>"SIZE"===e.type);a.length>0&&j(a[0].value),s.length>0&&I(s[0].value)}},[e]),(0,t.useEffect)(()=>{let a=async()=>{if(l&&e._id)try{R(!0),console.log("Fetching complete product data for:",e._id);let a=await E.h.products.getById(e._id);console.log("Complete product data:",a);let s=a;a&&!0===a.success&&a.data&&a.data.product&&(s=a.data.product,console.log("Using nested data.product format")),U(s),Z(0)}catch(a){console.error("Error fetching complete product data:",a),U(e)}finally{R(!1)}};a()},[l,e._id]);let G=async()=>{try{await V(X._id),L(X._id)?q({title:"Товар удален из избранного",description:`${X.name} удален из избранного`}):q({title:"Товар добавлен в избранное",description:`${X.name} добавлен в избранное`})}catch(e){q({title:"Ошибка",description:"Не удалось добавить товар в избранное",variant:"destructive"})}},Q=async e=>{e.preventDefault(),e.stopPropagation(),await G()},X=M||e,H=Array.from(new Set(X.variants&&Array.isArray(X.variants)?X.variants.filter(e=>"COLOR"===e.type).map(e=>e.value):[])),J=Array.from(new Set(X.variants&&Array.isArray(X.variants)?X.variants.filter(e=>"SIZE"===e.type).map(e=>e.value):[]));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(p.Vq,{open:l,onOpenChange:e=>{e||y(!1)},children:[r.jsx(p.hg,{asChild:!0,onClick:e=>{e.preventDefault(),e.stopPropagation(),y(!0)},children:s}),r.jsx(p.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0 sm:p-6 rounded-xl border-none shadow-2xl bg-gradient-to-b from-cream-50 to-white",onClick:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8",children:[(0,r.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[r.jsx("div",{className:"relative aspect-square overflow-hidden rounded-xl shadow-lg border border-secondary-100 premium-shadow bg-secondary-50",children:P?r.jsx("div",{className:"flex items-center justify-center h-full bg-secondary-50",children:r.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-400"})}):X.images&&X.images.length>0?(0,r.jsxs)(r.Fragment,{children:[r.jsx(T.w,{src:X.images[F].url,thumbnailSrc:X.images[F].thumbnailUrl,alt:X.images[F].alt||X.name,className:"w-full h-full object-cover"}),X.images.length>1&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(g.z,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/90 backdrop-blur-sm hover:bg-white rounded-full z-10 w-12 h-12 border border-primary-100 hover:border-primary-200 hover:scale-[1.03] transition-transform",onClick:()=>{X.images&&!(X.images.length<=1)&&Z(e=>(e-1+X.images.length)%X.images.length)},children:r.jsx(i.Z,{className:"w-5 h-5 text-charcoal-700"})}),r.jsx(g.z,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/90 backdrop-blur-sm hover:bg-white rounded-full z-10 w-12 h-12 border border-primary-100 hover:border-primary-200 hover:scale-[1.03] transition-transform",onClick:()=>{X.images&&!(X.images.length<=1)&&Z(e=>(e+1)%X.images.length)},children:r.jsx(n.Z,{className:"w-5 h-5 text-charcoal-700"})})]}),(0,r.jsxs)("div",{className:"absolute top-4 left-4 flex flex-col space-y-2 z-10",children:[X.isBrandNew&&r.jsx("span",{className:"bg-gradient-to-r from-gold-400 to-gold-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-md",children:"НОВОЕ"}),X.isOnSale&&r.jsx("span",{className:"bg-gradient-to-r from-accent-500 to-accent-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-md",children:"-20%"})]}),X.country&&r.jsx("div",{className:"absolute bottom-4 left-4",children:r.jsx("span",{className:"bg-white/90 backdrop-blur-sm text-charcoal-700 text-xs px-4 py-1.5 rounded-full font-medium shadow-sm border border-white/50",children:X.country})})]}):X.mainImage?r.jsx(T.w,{src:X.mainImage,alt:X.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"flex items-center justify-center h-full bg-secondary-50",children:r.jsx("span",{className:"text-charcoal-500",children:"Нет изображения"})})}),!P&&X.images&&X.images.length>1&&r.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-4",children:X.images.map((e,a)=>r.jsx("button",{className:(0,O.cn)("relative overflow-hidden rounded-xl h-20 transition-all cursor-pointer shadow-md hover:shadow-lg",F===a?"border-2 border-primary-500 ring-2 ring-primary-200 scale-105":"border border-secondary-100 hover:border-primary-200"),onClick:()=>Z(a),children:r.jsx(T.w,{src:e.url,thumbnailSrc:e.thumbnailUrl,alt:e.alt||`${X.name} ${a+1}`,className:"w-full h-full object-cover"})},a))})]}),(0,r.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 md:p-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between mb-3 gap-2",children:[r.jsx("span",{className:"text-sm text-charcoal-500 uppercase tracking-wider font-medium bg-secondary-50 px-3 py-1 rounded-full",children:X.category?.name||""}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 bg-gold-50 px-2 py-1 rounded-full",children:[r.jsx(c.Z,{className:"w-4 h-4 fill-gold-500 text-gold-500"}),r.jsx("span",{className:"text-sm text-charcoal-700 font-medium",children:X.rating||4.5})]})]}),r.jsx("h2",{className:"font-display text-xl sm:text-2xl lg:text-3xl font-bold text-charcoal-800 mb-3 sm:mb-4 tracking-tight",children:X.name}),r.jsx("p",{className:"text-charcoal-600 leading-relaxed line-clamp-2 sm:line-clamp-3 mb-3 sm:mb-4 text-sm sm:text-base",children:X.description})]}),r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-secondary-100 overflow-hidden",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"flex-1 p-4",children:[(0,r.jsxs)("span",{className:"text-2xl font-bold text-charcoal-800",children:[new Intl.NumberFormat("ru-RU").format(X.price)," ₽"]}),X.originalPrice&&(0,r.jsxs)("span",{className:"text-sm text-charcoal-500 line-through ml-2",children:[new Intl.NumberFormat("ru-RU").format(X.originalPrice)," ₽"]})]}),X.isOnSale&&r.jsx("div",{className:"bg-gradient-to-r from-accent-500 to-accent-600 text-white text-xs px-4 py-2 h-full flex items-center font-semibold",children:"Скидка"})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[H.length>0&&r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-secondary-100 p-4",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-0",children:[r.jsx("h3",{className:"font-medium text-charcoal-800 sm:w-24",children:"Цвет"}),r.jsx("div",{className:"flex-1",children:r.jsx(u.c,{colors:H,selectedColor:w||void 0,onColorChange:j,compact:!0})})]})}),J.length>0&&r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-secondary-100 p-4",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-0",children:[r.jsx("h3",{className:"font-medium text-charcoal-800 sm:w-24",children:"Размер"}),r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"flex flex-wrap gap-2",children:J.map(e=>r.jsx(g.z,{variant:N===e?"default":"outline",size:"sm",className:N===e?"bg-gradient-to-r from-primary-400 to-primary-500 text-primary-900 shadow-sm h-8 min-w-[40px]":"border border-secondary-200 hover:border-primary-300 hover:text-primary-600 h-8 min-w-[40px]",onClick:()=>I(e),children:e},e))})})]})}),r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-secondary-100 p-4",children:(0,r.jsxs)("div",{className:"flex flex-col space-y-3",children:[r.jsx("h3",{className:"font-medium text-charcoal-800",children:"Количество"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0",children:[(0,r.jsxs)("div",{className:"flex items-center border border-secondary-200 rounded-lg w-fit",children:[r.jsx(g.z,{variant:"ghost",size:"icon",onClick:()=>z(Math.max(1,_-1)),disabled:_<=1,className:"hover:bg-secondary-50 hover:text-primary-600 h-9 w-9",children:r.jsx(d.Z,{className:"w-4 h-4 text-charcoal-700"})}),r.jsx("span",{className:"px-4 text-center min-w-[40px] text-charcoal-800 font-medium",children:_}),r.jsx(g.z,{variant:"ghost",size:"icon",onClick:()=>z(Math.min(X.stock,_+1)),disabled:_>=X.stock,className:"hover:bg-secondary-50 hover:text-primary-600 h-9 w-9",children:r.jsx(m.Z,{className:"w-4 h-4 text-charcoal-700"})})]}),r.jsx("span",{className:`text-sm font-medium px-3 py-1 rounded-full ${X.stock>0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:X.stock>0?`В наличии: ${X.stock} шт.`:"Нет в наличии"})]})]})})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 pt-3 sm:pt-4",children:[(0,r.jsxs)(g.z,{onClick:()=>{if(!w&&!N){q({title:"Ошибка",description:"Пожалуйста, выберите цвет или размер",variant:"destructive"});return}if(X.stock<_){q({title:"Ошибка",description:"Недостаточно товара на складе",variant:"destructive"});return}B(X,_,N||void 0,w||void 0),q({title:"Товар добавлен в корзину",description:`${X.name} добавлен в корзину`}),y(!1)},disabled:0===X.stock,className:"flex-1 py-6 bg-gradient-to-r from-primary-400 to-primary-500 hover:from-primary-500 hover:to-primary-600 text-primary-900 shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300",children:[r.jsx(h.Z,{className:"w-5 h-5 mr-2"}),X.stock>0?"Добавить в корзину":"Нет в наличии"]}),r.jsx(g.z,{variant:"outline",size:"icon",className:"rounded-full w-14 h-14 border-2 border-secondary-200 hover:border-accent-300 hover:text-accent-500 shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300",onClick:Q,children:r.jsx(x.Z,{className:`w-6 h-6 ${L(X._id)?"fill-accent-500 text-accent-500":""}`})})]}),r.jsx("div",{className:"pt-2",children:r.jsx(g.z,{asChild:!0,variant:"ghost",className:"w-full hover:bg-secondary-50 hover:text-primary-600",children:r.jsx(o(),{href:`/product/${X.slug}`,children:"Перейти на страницу товара"})})})]})]})})]}),r.jsx(f.Q,{isOpen:$,onClose:()=>D(!1),message:"Для добавления товара в избранное необходимо войти в систему"})]})}},8931:(e,a,s)=>{s.d(a,{r:()=>l});var r=s(9885),t=s(7936);let l=()=>{let[e,a]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[o,i]=(0,r.useState)(!1),[n,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{try{let e=await t.h.auth.getProfile().catch(()=>null);if(i(!!e),e){l(!0);let e=await t.h.favorites.get();a(e.map(e=>e._id))}}catch(e){console.error("Failed to check auth or load favorites:",e)}finally{l(!1)}};e()},[]);let d=a=>e.includes(a),m=async e=>{if(console.log("toggleFavorite called, isLoggedIn:",o),!o){console.log("User not logged in, showing auth modal"),c(!0);return}try{console.log("User is logged in, toggling favorite"),d(e)?(await t.h.favorites.remove(e),a(a=>a.filter(a=>a!==e))):(await t.h.favorites.add(e),a(a=>[...a,e]))}catch(e){throw console.error("Failed to toggle favorite:",e),e}};return{favorites:e,loading:s,isLoggedIn:o,showAuthModal:n,setShowAuthModal:c,isFavorite:d,toggleFavorite:m}}}};