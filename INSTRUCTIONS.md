# Инструкция по инициализации и тестированию системы категорий и фильтров

## Обзор

В этом документе описаны шаги по инициализации категорий с фильтрами и тестированию универсальной системы фильтрации товаров.

## Инициализация категорий

### 1. Запуск скрипта инициализации

Для создания базовых категорий с предустановленными фильтрами выполните следующую команду в корневой директории сервера:

```bash
cd server
npm run init:categories
```

Эта команда создаст следующие категории с соответствующими фильтрами:

1. **Очки** (glasses)
   - Пол: мужской, женский, унисекс
   - Цена диапазоны
   - Бренд
   - Цвет
   - Материал оправы
   - Стиль обода оправы
   - Тип объектива

2. **Обувь** (shoes)
   - Категории: кроссовки, бутсы, баскетбольные кроссовки и т.д.
   - Бренд
   - Пол
   - Цена
   - Размер (RUS, EU, US, CM)
   - Цвет
   - Сезон/Коллекция
   - Материал верха
   - Стиль
   - Технологии брендов
   - Особенности модели
   - Тип подошвы
   - Комплектность
   - Наличие
   - Способ покупки

3. **Одежда** (clothing)
   - Категории: верхняя одежда, куртки, толстовки и т.д.
   - Бренд
   - Пол
   - Цена
   - Размер (INT, RUS, US)
   - Цвет
   - Сезон/Коллекция
   - Материал
   - Стиль
   - Рисунок/Принт
   - Технологии
   - Особенности модели
   - Наличие
   - Способ покупки

### 2. Проверка созданных категорий

После выполнения скрипта вы можете проверить созданные категории:

1. В админ-панели CRM (http://localhost:3000) перейдите в раздел "Категории"
2. Убедитесь, что все три основные категории созданы
3. Проверьте, что у каждой категории есть поле "filterTemplate" с соответствующими фильтрами

## Тестирование системы фильтрации

### 1. Тестирование на стороне клиента

1. Запустите клиентское приложение:
   ```bash
   cd client
   npm run dev
   ```

2. Перейдите на страницу каталога (http://localhost:3000/catalog)

3. Проверьте работу фильтров:
   - Убедитесь, что отображаются фильтры в зависимости от выбранной категории
   - Проверьте работу фильтра по цене
   - Проверьте работу фильтров по категориям
   - Проверьте работу фильтров по странам
   - Выберите категорию "Очки" и проверьте специфические фильтры для очков
   - Выберите категорию "Обувь" и проверьте специфические фильтры для обуви
   - Выберите категорию "Одежда" и проверьте специфические фильтры для одежды

4. Проверьте работу сортировки:
   - По популярности
   - По цене (возрастание/убывание)
   - По рейтингу
   - Сначала новинки

### 2. Тестирование на стороне CRM

1. Запустите CRM-клиент:
   ```bash
   cd crm-client
   npm run dev
   ```

2. Перейдите в раздел "Категории" (http://localhost:3001/categories)

3. Проверьте работу с иерархическими категориями:
   - Создайте новую категорию
   - Попробуйте выбрать родительскую категорию
   - Убедитесь, что нельзя выбрать текущую категорию или её дочерние элементы в качестве родительской
   - Отредактируйте существующую категорию, изменив её родителя

### 3. Тестирование API

1. Проверьте получение категорий с фильтрами:
   ```bash
   curl https://api.dvberry.ru/api/categories
   ```

2. Проверьте получение товаров с фильтрацией:
   ```bash
   curl "https://api.dvberry.ru/api/products?category=glasses&gender=MALE&price_min=1000&price_max=5000"
   ```

3. Проверьте получение товаров по категории:
   ```bash
   curl https://api.dvberry.ru/api/products/category/glasses
   ```

## Возможные проблемы и их решения

### 1. Проблема: Фильтры не отображаются на странице каталога

**Решение:**
- Убедитесь, что скрипт инициализации категорий был выполнен
- Проверьте, что у категорий есть поле `filterTemplate` с соответствующими фильтрами
- Проверьте консоль браузера на наличие ошибок JavaScript

### 2. Проблема: Фильтрация не работает

**Решение:**
- Проверьте, что товары имеют необходимые атрибуты в поле `attributes`
- Убедитесь, что ключи атрибутов товаров соответствуют ключам в шаблоне фильтров
- Проверьте консоль браузера на наличие ошибок

### 3. Проблема: Не работает иерархия категорий в CRM

**Решение:**
- Убедитесь, что у категорий правильно заполнены поля `parentId` и `level`
- Проверьте, что нет циклических ссылок в иерархии категорий

### 4. Проблема: Ошибка при создании категории в CRM

**Решение:**
- Проверьте, что все обязательные поля заполнены
- Убедитесь, что нет циклических ссылок при выборе родительской категории
- Проверьте консоль браузера на наличие ошибок

## Заключение

После выполнения всех шагов вы должны иметь полностью функциональную систему категорий с фильтрами, которая позволяет:

- Создавать иерархические категории
- Определять шаблоны фильтров для каждой категории
- Фильтровать товары по различным атрибутам
- Управлять категориями через CRM-интерфейс

Если у вас возникли проблемы, не описанные в этом документе, пожалуйста, обратитесь к разработчику системы.